var e=Object.create,t=Object.defineProperty,n=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyNames,i=Object.getPrototypeOf,a=Object.prototype.hasOwnProperty,o=(e,n,r)=>n in e?t(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r,s=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),c=(e,n)=>{for(var r in n)t(e,r,{get:n[r],enumerable:!0})},l=(e,i,o,s)=>{if(i&&typeof i==`object`||typeof i==`function`)for(let c of r(i))!a.call(e,c)&&c!==o&&t(e,c,{get:()=>i[c],enumerable:!(s=n(i,c))||s.enumerable});return e},u=(n,r,a)=>(a=n==null?{}:e(i(n)),l(r||!n||!n.__esModule?t(a,`default`,{value:n,enumerable:!0}):a,n)),d=(e,t,n)=>(o(e,typeof t==`symbol`?t:t+``,n),n),f=s((e,t)=>{function n(e){for(var t=Array(e),n=0;n<e;++n)t[n]=n;return t}t.exports=n}),p=s((e,t)=>{t.exports=function(e){return e!=null&&(n(e)||r(e)||!!e._isBuffer)};function n(e){return!!e.constructor&&typeof e.constructor.isBuffer==`function`&&e.constructor.isBuffer(e)}function r(e){return typeof e.readFloatLE==`function`&&typeof e.slice==`function`&&n(e.slice(0,0))}}),m=s((e,t)=>{var n=f(),r=p(),i=typeof Float64Array<`u`;function a(e,t){return e[0]-t[0]}function o(){var e=this.stride,t=Array(e.length),n;for(n=0;n<t.length;++n)t[n]=[Math.abs(e[n]),n];t.sort(a);var r=Array(t.length);for(n=0;n<r.length;++n)r[n]=t[n][1];return r}function s(e,t){var r=[`View`,t,`d`,e].join(``);t<0&&(r=`View_Nil`+e);var i=e===`generic`;if(t===-1){var a=`function `+r+`(a){this.data=a;};var proto=`+r+`.prototype;proto.dtype='`+e+`';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new `+r+`(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_`+r+`(a){return new `+r+`(a);}`,s=Function(a);return s()}else if(t===0){var a=`function `+r+`(a,d) {this.data = a;this.offset = d};var proto=`+r+`.prototype;proto.dtype='`+e+`';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function `+r+`_copy() {return new `+r+`(this.data,this.offset)};proto.pick=function `+r+`_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function `+r+`_get(){return `+(i?`this.data.get(this.offset)`:`this.data[this.offset]`)+`};proto.set=function `+r+`_set(v){return `+(i?`this.data.set(this.offset,v)`:`this.data[this.offset]=v`)+`};return function construct_`+r+`(a,b,c,d){return new `+r+`(a,d)}`,s=Function(`TrivialArray`,a);return s(l[e][0])}var a=[`'use strict'`],c=n(t),u=c.map(function(e){return`i`+e}),d=`this.offset+`+c.map(function(e){return`this.stride[`+e+`]*i`+e}).join(`+`),f=c.map(function(e){return`b`+e}).join(`,`),p=c.map(function(e){return`c`+e}).join(`,`);a.push(`function `+r+`(a,`+f+`,`+p+`,d){this.data=a`,`this.shape=[`+f+`]`,`this.stride=[`+p+`]`,`this.offset=d|0}`,`var proto=`+r+`.prototype`,`proto.dtype='`+e+`'`,`proto.dimension=`+t),a.push(`Object.defineProperty(proto,'size',{get:function `+r+`_size(){return `+c.map(function(e){return`this.shape[`+e+`]`}).join(`*`),`}})`),t===1?a.push(`proto.order=[0]`):(a.push(`Object.defineProperty(proto,'order',{get:`),t<4?(a.push(`function `+r+`_order(){`),t===2?a.push(`return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})`):t===3&&a.push(`var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})`)):a.push(`ORDER})`)),a.push(`proto.set=function `+r+`_set(`+u.join(`,`)+`,v){`),i?a.push(`return this.data.set(`+d+`,v)}`):a.push(`return this.data[`+d+`]=v}`),a.push(`proto.get=function `+r+`_get(`+u.join(`,`)+`){`),i?a.push(`return this.data.get(`+d+`)}`):a.push(`return this.data[`+d+`]}`),a.push(`proto.index=function `+r+`_index(`,u.join(),`){return `+d+`}`),a.push(`proto.hi=function `+r+`_hi(`+u.join(`,`)+`){return new `+r+`(this.data,`+c.map(function(e){return[`(typeof i`,e,`!=='number'||i`,e,`<0)?this.shape[`,e,`]:i`,e,`|0`].join(``)}).join(`,`)+`,`+c.map(function(e){return`this.stride[`+e+`]`}).join(`,`)+`,this.offset)}`);var m=c.map(function(e){return`a`+e+`=this.shape[`+e+`]`}),h=c.map(function(e){return`c`+e+`=this.stride[`+e+`]`});a.push(`proto.lo=function `+r+`_lo(`+u.join(`,`)+`){var b=this.offset,d=0,`+m.join(`,`)+`,`+h.join(`,`));for(var g=0;g<t;++g)a.push(`if(typeof i`+g+`==='number'&&i`+g+`>=0){d=i`+g+`|0;b+=c`+g+`*d;a`+g+`-=d}`);a.push(`return new `+r+`(this.data,`+c.map(function(e){return`a`+e}).join(`,`)+`,`+c.map(function(e){return`c`+e}).join(`,`)+`,b)}`),a.push(`proto.step=function `+r+`_step(`+u.join(`,`)+`){var `+c.map(function(e){return`a`+e+`=this.shape[`+e+`]`}).join(`,`)+`,`+c.map(function(e){return`b`+e+`=this.stride[`+e+`]`}).join(`,`)+`,c=this.offset,d=0,ceil=Math.ceil`);for(var g=0;g<t;++g)a.push(`if(typeof i`+g+`==='number'){d=i`+g+`|0;if(d<0){c+=b`+g+`*(a`+g+`-1);a`+g+`=ceil(-a`+g+`/d)}else{a`+g+`=ceil(a`+g+`/d)}b`+g+`*=d}`);a.push(`return new `+r+`(this.data,`+c.map(function(e){return`a`+e}).join(`,`)+`,`+c.map(function(e){return`b`+e}).join(`,`)+`,c)}`);for(var _=Array(t),v=Array(t),g=0;g<t;++g)_[g]=`a[i`+g+`]`,v[g]=`b[i`+g+`]`;a.push(`proto.transpose=function `+r+`_transpose(`+u+`){`+u.map(function(e,t){return e+`=(`+e+`===undefined?`+t+`:`+e+`|0)`}).join(`;`),`var a=this.shape,b=this.stride;return new `+r+`(this.data,`+_.join(`,`)+`,`+v.join(`,`)+`,this.offset)}`),a.push(`proto.pick=function `+r+`_pick(`+u+`){var a=[],b=[],c=this.offset`);for(var g=0;g<t;++g)a.push(`if(typeof i`+g+`==='number'&&i`+g+`>=0){c=(c+this.stride[`+g+`]*i`+g+`)|0}else{a.push(this.shape[`+g+`]);b.push(this.stride[`+g+`])}`);a.push(`var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}`),a.push(`return function construct_`+r+`(data,shape,stride,offset){return new `+r+`(data,`+c.map(function(e){return`shape[`+e+`]`}).join(`,`)+`,`+c.map(function(e){return`stride[`+e+`]`}).join(`,`)+`,offset)}`);var s=Function(`CTOR_LIST`,`ORDER`,a.join(`
`));return s(l[e],o)}function c(e){if(r(e))return`buffer`;if(i)switch(Object.prototype.toString.call(e)){case`[object Float64Array]`:return`float64`;case`[object Float32Array]`:return`float32`;case`[object Int8Array]`:return`int8`;case`[object Int16Array]`:return`int16`;case`[object Int32Array]`:return`int32`;case`[object Uint8Array]`:return`uint8`;case`[object Uint16Array]`:return`uint16`;case`[object Uint32Array]`:return`uint32`;case`[object Uint8ClampedArray]`:return`uint8_clamped`;case`[object BigInt64Array]`:return`bigint64`;case`[object BigUint64Array]`:return`biguint64`}return Array.isArray(e)?`array`:`generic`}var l={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};function u(e,t,n,r){if(e===void 0){var i=l.array[0];return i([])}else typeof e==`number`&&(e=[e]);t===void 0&&(t=[e.length]);var a=t.length;if(n===void 0){n=Array(a);for(var o=a-1,u=1;o>=0;--o)n[o]=u,u*=t[o]}if(r===void 0){r=0;for(var o=0;o<a;++o)n[o]<0&&(r-=(t[o]-1)*n[o])}for(var d=c(e),f=l[d];f.length<=a+1;)f.push(s(d,f.length-1));var i=f[a+1];return i(e,t,n,r)}t.exports=u}),h=s((e,t)=>{function n(e,t){for(var n=1,r=e.length,i=e[0],a=e[0],o=1;o<r;++o)if(a=i,i=e[o],t(i,a)){if(o===n){n++;continue}e[n++]=i}return e.length=n,e}function r(e){for(var t=1,n=e.length,r=e[0],i=e[0],a=1;a<n;++a,i=r)if(i=r,r=e[a],r!==i){if(a===t){t++;continue}e[t++]=r}return e.length=t,e}function i(e,t,i){return e.length===0?e:t?(i||e.sort(t),n(e,t)):(i||e.sort(),r(e))}t.exports=i}),g=s((e,t)=>{var n=h();function r(e,t,n){var r=e.length,i=t.arrayArgs.length,a=t.indexArgs.length>0,o=[],s=[],c=0,l=0,u,d;for(u=0;u<r;++u)s.push([`i`,u,`=0`].join(``));for(d=0;d<i;++d)for(u=0;u<r;++u)l=c,c=e[u],u===0?s.push([`d`,d,`s`,u,`=t`,d,`p`,c].join(``)):s.push([`d`,d,`s`,u,`=(t`,d,`p`,c,`-s`,l,`*t`,d,`p`,l,`)`].join(``));for(s.length>0&&o.push(`var `+s.join(`,`)),u=r-1;u>=0;--u)c=e[u],o.push([`for(i`,u,`=0;i`,u,`<s`,c,`;++i`,u,`){`].join(``));for(o.push(n),u=0;u<r;++u){for(l=c,c=e[u],d=0;d<i;++d)o.push([`p`,d,`+=d`,d,`s`,u].join(``));a&&(u>0&&o.push([`index[`,l,`]-=s`,l].join(``)),o.push([`++index[`,c,`]`].join(``))),o.push(`}`)}return o.join(`
`)}function i(e,t,n,i){for(var a=t.length,o=n.arrayArgs.length,s=n.blockSize,c=n.indexArgs.length>0,l=[],u=0;u<o;++u)l.push([`var offset`,u,`=p`,u].join(``));for(var u=e;u<a;++u)l.push([`for(var j`+u+`=SS[`,t[u],`]|0;j`,u,`>0;){`].join(``)),l.push([`if(j`,u,`<`,s,`){`].join(``)),l.push([`s`,t[u],`=j`,u].join(``)),l.push([`j`,u,`=0`].join(``)),l.push([`}else{s`,t[u],`=`,s].join(``)),l.push([`j`,u,`-=`,s,`}`].join(``)),c&&l.push([`index[`,t[u],`]=j`,u].join(``));for(var u=0;u<o;++u){for(var d=[`offset`+u],f=e;f<a;++f)d.push([`j`,f,`*t`,u,`p`,t[f]].join(``));l.push([`p`,u,`=(`,d.join(`+`),`)`].join(``))}l.push(r(t,n,i));for(var u=e;u<a;++u)l.push(`}`);return l.join(`
`)}function a(e){for(var t=0,n=e[0].length;t<n;){for(var r=1;r<e.length;++r)if(e[r][t]!==e[0][t])return t;++t}return t}function o(e,t,n){for(var r=e.body,i=[],a=[],o=0;o<e.args.length;++o){var s=e.args[o];if(!(s.count<=0)){var c=new RegExp(s.name,`g`),l=``,u=t.arrayArgs.indexOf(o);switch(t.argTypes[o]){case`offset`:var d=t.offsetArgIndex.indexOf(o);u=t.offsetArgs[d].array,l=`+q`+d;case`array`:l=`p`+u+l;var f=`l`+o,p=`a`+u;if(t.arrayBlockIndices[u]===0)s.count===1?n[u]===`generic`?s.lvalue?(i.push([`var `,f,`=`,p,`.get(`,l,`)`].join(``)),r=r.replace(c,f),a.push([p,`.set(`,l,`,`,f,`)`].join(``))):r=r.replace(c,[p,`.get(`,l,`)`].join(``)):r=r.replace(c,[p,`[`,l,`]`].join(``)):n[u]===`generic`?(i.push([`var `,f,`=`,p,`.get(`,l,`)`].join(``)),r=r.replace(c,f),s.lvalue&&a.push([p,`.set(`,l,`,`,f,`)`].join(``))):(i.push([`var `,f,`=`,p,`[`,l,`]`].join(``)),r=r.replace(c,f),s.lvalue&&a.push([p,`[`,l,`]=`,f].join(``)));else{for(var m=[s.name],h=[l],g=0;g<Math.abs(t.arrayBlockIndices[u]);g++)m.push(`\\s*\\[([^\\]]+)\\]`),h.push(`$`+(g+1)+`*t`+u+`b`+g);if(c=new RegExp(m.join(``),`g`),l=h.join(`+`),n[u]===`generic`)throw Error(`cwise: Generic arrays not supported in combination with blocks!`);r=r.replace(c,[p,`[`,l,`]`].join(``))}break;case`scalar`:r=r.replace(c,`Y`+t.scalarArgs.indexOf(o));break;case`index`:r=r.replace(c,`index`);break;case`shape`:r=r.replace(c,`shape`);break}}}return[i.join(`
`),r,a.join(`
`)].join(`
`).trim()}function s(e){for(var t=Array(e.length),n=!0,r=0;r<e.length;++r){var i=e[r],a=i.match(/\d+/);a=a?a[0]:``,i.charAt(0)===0?t[r]=`u`+i.charAt(1)+a:t[r]=i.charAt(0)+a,r>0&&(n&&=t[r]===t[r-1])}return n?t[0]:t.join(``)}function c(e,t){for(var c=t[1].length-Math.abs(e.arrayBlockIndices[0])|0,l=Array(e.arrayArgs.length),u=Array(e.arrayArgs.length),d=0;d<e.arrayArgs.length;++d)u[d]=t[2*d],l[d]=t[2*d+1];for(var f=[],p=[],m=[],h=[],g=[],d=0;d<e.arrayArgs.length;++d){e.arrayBlockIndices[d]<0?(m.push(0),h.push(c),f.push(c),p.push(c+e.arrayBlockIndices[d])):(m.push(e.arrayBlockIndices[d]),h.push(e.arrayBlockIndices[d]+c),f.push(0),p.push(e.arrayBlockIndices[d]));for(var _=[],v=0;v<l[d].length;v++)m[d]<=l[d][v]&&l[d][v]<h[d]&&_.push(l[d][v]-m[d]);g.push(_)}for(var y=[`SS`],b=[`'use strict'`],x=[],v=0;v<c;++v)x.push([`s`,v,`=SS[`,v,`]`].join(``));for(var d=0;d<e.arrayArgs.length;++d){y.push(`a`+d),y.push(`t`+d),y.push(`p`+d);for(var v=0;v<c;++v)x.push([`t`,d,`p`,v,`=t`,d,`[`,m[d]+v,`]`].join(``));for(var v=0;v<Math.abs(e.arrayBlockIndices[d]);++v)x.push([`t`,d,`b`,v,`=t`,d,`[`,f[d]+v,`]`].join(``))}for(var d=0;d<e.scalarArgs.length;++d)y.push(`Y`+d);if(e.shapeArgs.length>0&&x.push(`shape=SS.slice(0)`),e.indexArgs.length>0){for(var S=Array(c),d=0;d<c;++d)S[d]=`0`;x.push([`index=[`,S.join(`,`),`]`].join(``))}for(var d=0;d<e.offsetArgs.length;++d){for(var C=e.offsetArgs[d],w=[],v=0;v<C.offset.length;++v)C.offset[v]!==0&&(C.offset[v]===1?w.push([`t`,C.array,`p`,v].join(``)):w.push([C.offset[v],`*t`,C.array,`p`,v].join(``)));w.length===0?x.push(`q`+d+`=0`):x.push([`q`,d,`=`,w.join(`+`)].join(``))}var T=n([].concat(e.pre.thisVars,e.body.thisVars,e.post.thisVars));x=x.concat(T),x.length>0&&b.push(`var `+x.join(`,`));for(var d=0;d<e.arrayArgs.length;++d)b.push(`p`+d+`|=0`);e.pre.body.length>3&&b.push(o(e.pre,e,u));var E=o(e.body,e,u),D=a(g);D<c?b.push(i(D,g[0],e,E)):b.push(r(g[0],e,E)),e.post.body.length>3&&b.push(o(e.post,e,u)),e.debug&&console.log(`-----Generated cwise routine for `,t,`:
`+b.join(`
`)+`
----------`);var O=[e.funcName||`unnamed`,`_cwise_loop_`,l[0].join(`s`),`m`,D,s(u)].join(``);return Function([`function `,O,`(`,y.join(`,`),`){`,b.join(`
`),`} return `,O].join(``))()}t.exports=c}),_=s((e,t)=>{var n=g();function r(e){var t=[`'use strict'`,`var CACHED={}`],r=[],i=e.funcName+`_cwise_thunk`;t.push([`return function `,i,`(`,e.shimArgs.join(`,`),`){`].join(``));for(var a=[],o=[],s=[[`array`,e.arrayArgs[0],`.shape.slice(`,Math.max(0,e.arrayBlockIndices[0]),e.arrayBlockIndices[0]<0?`,`+e.arrayBlockIndices[0]+`)`:`)`].join(``)],c=[],l=[],u=0;u<e.arrayArgs.length;++u){var d=e.arrayArgs[u];r.push([`t`,d,`=array`,d,`.dtype,`,`r`,d,`=array`,d,`.order`].join(``)),a.push(`t`+d),a.push(`r`+d),o.push(`t`+d),o.push(`r`+d+`.join()`),s.push(`array`+d+`.data`),s.push(`array`+d+`.stride`),s.push(`array`+d+`.offset|0`),u>0&&(c.push(`array`+e.arrayArgs[0]+`.shape.length===array`+d+`.shape.length+`+(Math.abs(e.arrayBlockIndices[0])-Math.abs(e.arrayBlockIndices[u]))),l.push(`array`+e.arrayArgs[0]+`.shape[shapeIndex+`+Math.max(0,e.arrayBlockIndices[0])+`]===array`+d+`.shape[shapeIndex+`+Math.max(0,e.arrayBlockIndices[u])+`]`))}e.arrayArgs.length>1&&(t.push(`if (!(`+c.join(` && `)+`)) throw new Error('cwise: Arrays do not all have the same dimensionality!')`),t.push(`for(var shapeIndex=array`+e.arrayArgs[0]+`.shape.length-`+Math.abs(e.arrayBlockIndices[0])+`; shapeIndex-->0;) {`),t.push(`if (!(`+l.join(` && `)+`)) throw new Error('cwise: Arrays do not all have the same shape!')`),t.push(`}`));for(var u=0;u<e.scalarArgs.length;++u)s.push(`scalar`+e.scalarArgs[u]);return r.push([`type=[`,o.join(`,`),`].join()`].join(``)),r.push(`proc=CACHED[type]`),t.push(`var `+r.join(`,`)),t.push([`if(!proc){`,`CACHED[type]=proc=compile([`,a.join(`,`),`])}`,`return proc(`,s.join(`,`),`)}`].join(``)),e.debug&&console.log(`-----Generated thunk:
`+t.join(`
`)+`
----------`),Function(`compile`,t.join(`
`))(n.bind(void 0,e))}t.exports=r}),v=s((e,t)=>{var n=_();function r(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName=``,this.pre=null,this.body=null,this.post=null,this.debug=!1}function i(e){var t=new r;t.pre=e.pre,t.body=e.body,t.post=e.post;var i=e.args.slice(0);t.argTypes=i;for(var a=0;a<i.length;++a){var o=i[a];if(o===`array`||typeof o==`object`&&o.blockIndices){if(t.argTypes[a]=`array`,t.arrayArgs.push(a),t.arrayBlockIndices.push(o.blockIndices?o.blockIndices:0),t.shimArgs.push(`array`+a),a<t.pre.args.length&&t.pre.args[a].count>0)throw Error(`cwise: pre() block may not reference array args`);if(a<t.post.args.length&&t.post.args[a].count>0)throw Error(`cwise: post() block may not reference array args`)}else if(o===`scalar`)t.scalarArgs.push(a),t.shimArgs.push(`scalar`+a);else if(o===`index`){if(t.indexArgs.push(a),a<t.pre.args.length&&t.pre.args[a].count>0)throw Error(`cwise: pre() block may not reference array index`);if(a<t.body.args.length&&t.body.args[a].lvalue)throw Error(`cwise: body() block may not write to array index`);if(a<t.post.args.length&&t.post.args[a].count>0)throw Error(`cwise: post() block may not reference array index`)}else if(o===`shape`){if(t.shapeArgs.push(a),a<t.pre.args.length&&t.pre.args[a].lvalue)throw Error(`cwise: pre() block may not write to array shape`);if(a<t.body.args.length&&t.body.args[a].lvalue)throw Error(`cwise: body() block may not write to array shape`);if(a<t.post.args.length&&t.post.args[a].lvalue)throw Error(`cwise: post() block may not write to array shape`)}else if(typeof o==`object`&&o.offset)t.argTypes[a]=`offset`,t.offsetArgs.push({array:o.array,offset:o.offset}),t.offsetArgIndex.push(a);else throw Error(`cwise: Unknown argument type `+i[a])}if(t.arrayArgs.length<=0)throw Error(`cwise: No array arguments specified`);if(t.pre.args.length>i.length)throw Error(`cwise: Too many arguments in pre() block`);if(t.body.args.length>i.length)throw Error(`cwise: Too many arguments in body() block`);if(t.post.args.length>i.length)throw Error(`cwise: Too many arguments in post() block`);return t.debug=!!e.printCode||!!e.debug,t.funcName=e.funcName||`cwise`,t.blockSize=e.blockSize||64,n(t)}t.exports=i}),y=s(e=>{var t=v(),n={body:``,args:[],thisVars:[],localVars:[]};function r(e){if(!e)return n;for(var t=0;t<e.args.length;++t){var r=e.args[t];t===0?e.args[t]={name:r,lvalue:!0,rvalue:!!e.rvalue,count:e.count||1}:e.args[t]={name:r,lvalue:!1,rvalue:!0,count:1}}return e.thisVars||=[],e.localVars||=[],e}function i(e){return t({args:e.args,pre:r(e.pre),body:r(e.body),post:r(e.proc),funcName:e.funcName})}function a(e){for(var t=[],n=0;n<e.args.length;++n)t.push(`a`+n);return Function(`P`,[`return function `,e.funcName,`_ndarrayops(`,t.join(`,`),`) {P(`,t.join(`,`),`);return a0}`].join(``))(i(e))}var o={add:`+`,sub:`-`,mul:`*`,div:`/`,mod:`%`,band:`&`,bor:`|`,bxor:`^`,lshift:`<<`,rshift:`>>`,rrshift:`>>>`};(function(){for(var t in o){var n=o[t];e[t]=a({args:[`array`,`array`,`array`],body:{args:[`a`,`b`,`c`],body:`a=b`+n+`c`},funcName:t}),e[t+`eq`]=a({args:[`array`,`array`],body:{args:[`a`,`b`],body:`a`+n+`=b`},rvalue:!0,funcName:t+`eq`}),e[t+`s`]=a({args:[`array`,`array`,`scalar`],body:{args:[`a`,`b`,`s`],body:`a=b`+n+`s`},funcName:t+`s`}),e[t+`seq`]=a({args:[`array`,`scalar`],body:{args:[`a`,`s`],body:`a`+n+`=s`},rvalue:!0,funcName:t+`seq`})}})();var s={not:`!`,bnot:`~`,neg:`-`,recip:`1.0/`};(function(){for(var t in s){var n=s[t];e[t]=a({args:[`array`,`array`],body:{args:[`a`,`b`],body:`a=`+n+`b`},funcName:t}),e[t+`eq`]=a({args:[`array`],body:{args:[`a`],body:`a=`+n+`a`},rvalue:!0,count:2,funcName:t+`eq`})}})();var c={and:`&&`,or:`||`,eq:`===`,neq:`!==`,lt:`<`,gt:`>`,leq:`<=`,geq:`>=`};(function(){for(var t in c){var n=c[t];e[t]=a({args:[`array`,`array`,`array`],body:{args:[`a`,`b`,`c`],body:`a=b`+n+`c`},funcName:t}),e[t+`s`]=a({args:[`array`,`array`,`scalar`],body:{args:[`a`,`b`,`s`],body:`a=b`+n+`s`},funcName:t+`s`}),e[t+`eq`]=a({args:[`array`,`array`],body:{args:[`a`,`b`],body:`a=a`+n+`b`},rvalue:!0,count:2,funcName:t+`eq`}),e[t+`seq`]=a({args:[`array`,`scalar`],body:{args:[`a`,`s`],body:`a=a`+n+`s`},rvalue:!0,count:2,funcName:t+`seq`})}})();var l=[`abs`,`acos`,`asin`,`atan`,`ceil`,`cos`,`exp`,`floor`,`log`,`round`,`sin`,`sqrt`,`tan`];(function(){for(var t=0;t<l.length;++t){var n=l[t];e[n]=a({args:[`array`,`array`],pre:{args:[],body:`this_f=Math.`+n,thisVars:[`this_f`]},body:{args:[`a`,`b`],body:`a=this_f(b)`,thisVars:[`this_f`]},funcName:n}),e[n+`eq`]=a({args:[`array`],pre:{args:[],body:`this_f=Math.`+n,thisVars:[`this_f`]},body:{args:[`a`],body:`a=this_f(a)`,thisVars:[`this_f`]},rvalue:!0,count:2,funcName:n+`eq`})}})();var u=[`max`,`min`,`atan2`,`pow`];(function(){for(var t=0;t<u.length;++t){var n=u[t];e[n]=a({args:[`array`,`array`,`array`],pre:{args:[],body:`this_f=Math.`+n,thisVars:[`this_f`]},body:{args:[`a`,`b`,`c`],body:`a=this_f(b,c)`,thisVars:[`this_f`]},funcName:n}),e[n+`s`]=a({args:[`array`,`array`,`scalar`],pre:{args:[],body:`this_f=Math.`+n,thisVars:[`this_f`]},body:{args:[`a`,`b`,`c`],body:`a=this_f(b,c)`,thisVars:[`this_f`]},funcName:n+`s`}),e[n+`eq`]=a({args:[`array`,`array`],pre:{args:[],body:`this_f=Math.`+n,thisVars:[`this_f`]},body:{args:[`a`,`b`],body:`a=this_f(a,b)`,thisVars:[`this_f`]},rvalue:!0,count:2,funcName:n+`eq`}),e[n+`seq`]=a({args:[`array`,`scalar`],pre:{args:[],body:`this_f=Math.`+n,thisVars:[`this_f`]},body:{args:[`a`,`b`],body:`a=this_f(a,b)`,thisVars:[`this_f`]},rvalue:!0,count:2,funcName:n+`seq`})}})();var d=[`atan2`,`pow`];(function(){for(var t=0;t<d.length;++t){var n=d[t];e[n+`op`]=a({args:[`array`,`array`,`array`],pre:{args:[],body:`this_f=Math.`+n,thisVars:[`this_f`]},body:{args:[`a`,`b`,`c`],body:`a=this_f(c,b)`,thisVars:[`this_f`]},funcName:n+`op`}),e[n+`ops`]=a({args:[`array`,`array`,`scalar`],pre:{args:[],body:`this_f=Math.`+n,thisVars:[`this_f`]},body:{args:[`a`,`b`,`c`],body:`a=this_f(c,b)`,thisVars:[`this_f`]},funcName:n+`ops`}),e[n+`opeq`]=a({args:[`array`,`array`],pre:{args:[],body:`this_f=Math.`+n,thisVars:[`this_f`]},body:{args:[`a`,`b`],body:`a=this_f(b,a)`,thisVars:[`this_f`]},rvalue:!0,count:2,funcName:n+`opeq`}),e[n+`opseq`]=a({args:[`array`,`scalar`],pre:{args:[],body:`this_f=Math.`+n,thisVars:[`this_f`]},body:{args:[`a`,`b`],body:`a=this_f(b,a)`,thisVars:[`this_f`]},rvalue:!0,count:2,funcName:n+`opseq`})}})(),e.any=t({args:[`array`],pre:n,body:{args:[{name:`a`,lvalue:!1,rvalue:!0,count:1}],body:`if(a){return true}`,localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:`return false`},funcName:`any`}),e.all=t({args:[`array`],pre:n,body:{args:[{name:`x`,lvalue:!1,rvalue:!0,count:1}],body:`if(!x){return false}`,localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:`return true`},funcName:`all`}),e.sum=t({args:[`array`],pre:{args:[],localVars:[],thisVars:[`this_s`],body:`this_s=0`},body:{args:[{name:`a`,lvalue:!1,rvalue:!0,count:1}],body:`this_s+=a`,localVars:[],thisVars:[`this_s`]},post:{args:[],localVars:[],thisVars:[`this_s`],body:`return this_s`},funcName:`sum`}),e.prod=t({args:[`array`],pre:{args:[],localVars:[],thisVars:[`this_s`],body:`this_s=1`},body:{args:[{name:`a`,lvalue:!1,rvalue:!0,count:1}],body:`this_s*=a`,localVars:[],thisVars:[`this_s`]},post:{args:[],localVars:[],thisVars:[`this_s`],body:`return this_s`},funcName:`prod`}),e.norm2squared=t({args:[`array`],pre:{args:[],localVars:[],thisVars:[`this_s`],body:`this_s=0`},body:{args:[{name:`a`,lvalue:!1,rvalue:!0,count:2}],body:`this_s+=a*a`,localVars:[],thisVars:[`this_s`]},post:{args:[],localVars:[],thisVars:[`this_s`],body:`return this_s`},funcName:`norm2squared`}),e.norm2=t({args:[`array`],pre:{args:[],localVars:[],thisVars:[`this_s`],body:`this_s=0`},body:{args:[{name:`a`,lvalue:!1,rvalue:!0,count:2}],body:`this_s+=a*a`,localVars:[],thisVars:[`this_s`]},post:{args:[],localVars:[],thisVars:[`this_s`],body:`return Math.sqrt(this_s)`},funcName:`norm2`}),e.norminf=t({args:[`array`],pre:{args:[],localVars:[],thisVars:[`this_s`],body:`this_s=0`},body:{args:[{name:`a`,lvalue:!1,rvalue:!0,count:4}],body:`if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}`,localVars:[],thisVars:[`this_s`]},post:{args:[],localVars:[],thisVars:[`this_s`],body:`return this_s`},funcName:`norminf`}),e.norm1=t({args:[`array`],pre:{args:[],localVars:[],thisVars:[`this_s`],body:`this_s=0`},body:{args:[{name:`a`,lvalue:!1,rvalue:!0,count:3}],body:`this_s+=a<0?-a:a`,localVars:[],thisVars:[`this_s`]},post:{args:[],localVars:[],thisVars:[`this_s`],body:`return this_s`},funcName:`norm1`}),e.sup=t({args:[`array`],pre:{body:`this_h=-Infinity`,args:[],thisVars:[`this_h`],localVars:[]},body:{body:`if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_`,args:[{name:`_inline_1_arg0_`,lvalue:!1,rvalue:!0,count:2}],thisVars:[`this_h`],localVars:[]},post:{body:`return this_h`,args:[],thisVars:[`this_h`],localVars:[]}}),e.inf=t({args:[`array`],pre:{body:`this_h=Infinity`,args:[],thisVars:[`this_h`],localVars:[]},body:{body:`if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_`,args:[{name:`_inline_1_arg0_`,lvalue:!1,rvalue:!0,count:2}],thisVars:[`this_h`],localVars:[]},post:{body:`return this_h`,args:[],thisVars:[`this_h`],localVars:[]}}),e.argmin=t({args:[`index`,`array`,`shape`],pre:{body:`{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}`,args:[{name:`_inline_0_arg0_`,lvalue:!1,rvalue:!1,count:0},{name:`_inline_0_arg1_`,lvalue:!1,rvalue:!1,count:0},{name:`_inline_0_arg2_`,lvalue:!1,rvalue:!0,count:1}],thisVars:[`this_i`,`this_v`],localVars:[]},body:{body:`{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}`,args:[{name:`_inline_1_arg0_`,lvalue:!1,rvalue:!0,count:2},{name:`_inline_1_arg1_`,lvalue:!1,rvalue:!0,count:2}],thisVars:[`this_i`,`this_v`],localVars:[`_inline_1_k`]},post:{body:`{return this_i}`,args:[],thisVars:[`this_i`],localVars:[]}}),e.argmax=t({args:[`index`,`array`,`shape`],pre:{body:`{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}`,args:[{name:`_inline_0_arg0_`,lvalue:!1,rvalue:!1,count:0},{name:`_inline_0_arg1_`,lvalue:!1,rvalue:!1,count:0},{name:`_inline_0_arg2_`,lvalue:!1,rvalue:!0,count:1}],thisVars:[`this_i`,`this_v`],localVars:[]},body:{body:`{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}`,args:[{name:`_inline_1_arg0_`,lvalue:!1,rvalue:!0,count:2},{name:`_inline_1_arg1_`,lvalue:!1,rvalue:!0,count:2}],thisVars:[`this_i`,`this_v`],localVars:[`_inline_1_k`]},post:{body:`{return this_i}`,args:[],thisVars:[`this_i`],localVars:[]}}),e.random=a({args:[`array`],pre:{args:[],body:`this_f=Math.random`,thisVars:[`this_f`]},body:{args:[`a`],body:`a=this_f()`,thisVars:[`this_f`]},funcName:`random`}),e.assign=a({args:[`array`,`array`],body:{args:[`a`,`b`],body:`a=b`},funcName:`assign`}),e.assigns=a({args:[`array`,`scalar`],body:{args:[`a`,`b`],body:`a=b`},funcName:`assigns`}),e.equals=t({args:[`array`,`array`],pre:n,body:{args:[{name:`x`,lvalue:!1,rvalue:!0,count:1},{name:`y`,lvalue:!1,rvalue:!0,count:1}],body:`if(x!==y){return false}`,localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:`return true`},funcName:`equals`})}),b=u(m(),1),x=u(y(),1),S=u(m(),1),C=u(y(),1),w=class{constructor(e,t,n){this._dataNormalized=e,this._minD=t,this._maxD=n}static createFromUnnormalized(e){let t=C.sup(e),n=C.inf(e),r=(0,S.default)(new Float32Array(e.size),e.shape),i=t-n;return i<1e-4?C.assigns(r,0):(C.subs(r,e,n),C.divs(r,r,i)),new w(r,n,t)}get data(){return this._dataNormalized}get minD(){return this._minD}get maxD(){return this._maxD}denormalize(){let e=(0,S.default)(new Float32Array(this._dataNormalized.size),this._dataNormalized.shape);return C.muls(e,this._dataNormalized,this._maxD-this._minD),C.adds(e,e,this._minD),e}},T=class{constructor(e,t){this._quantized=e,this._method=t}get quantized(){return this._quantized}static maxIntBits(e){return 2**e-1}static fromNormalized(e,t){let n=e.data,r;if(t===`norm8x`){let e=T.maxIntBits(8),t=(0,S.default)(new Float32Array(n.size),n.shape);C.muls(t,n,e),C.roundeq(t),r=(0,S.default)(new Uint8Array(t.data),n.shape)}else if(t===`norm565`){let e=(0,S.default)(new Float32Array(n.size),n.shape);C.assign(e,n),C.mulseq(e.pick(null,0),T.maxIntBits(5)),C.mulseq(e.pick(null,1),T.maxIntBits(6)),C.mulseq(e.pick(null,2),T.maxIntBits(5)),C.roundeq(e);let t=(0,S.default)(new Uint16Array(e.data),n.shape),i=(0,S.default)(new Uint16Array(n.shape[0]),[n.shape[0]]),a=(0,S.default)(new Uint16Array(n.shape[0]),[n.shape[0]]);C.lshifts(i,t.pick(null,0),11),C.lshifts(a,t.pick(null,1),5),C.boreq(i,a),C.boreq(i,t.pick(null,2)),r=i}else{let e=(0,S.default)(new Float32Array(n.size),n.shape);C.assign(e,n),C.mulseq(e.pick(null,0),T.maxIntBits(11)),C.mulseq(e.pick(null,1),T.maxIntBits(10)),C.mulseq(e.pick(null,2),T.maxIntBits(11)),C.roundeq(e);let t=(0,S.default)(new Uint32Array(e.data),n.shape),i=(0,S.default)(new Uint32Array(n.shape[0]),[n.shape[0]]),a=(0,S.default)(new Uint32Array(n.shape[0]),[n.shape[0]]);C.lshifts(i,t.pick(null,0),21),C.lshifts(a,t.pick(null,1),11),C.boreq(i,a),C.boreq(i,t.pick(null,2)),r=i}return new T(r,t)}dequantize(e,t){let n=this._method,r,i=this._quantized;if(n===`norm8x`){let e=T.maxIntBits(8);r=(0,S.default)(new Float32Array(i.size),i.shape),C.muls(r,i,1/e)}else if(n===`norm565`){let e=(0,S.default)(new Uint8Array(i.shape[0]),[i.shape[0]]),t=(0,S.default)(new Uint8Array(i.shape[0]),[i.shape[0]]),n=(0,S.default)(new Uint8Array(i.shape[0]),[i.shape[0]]);C.rrshifts(e,i,11),C.rrshifts(t,i,5),C.bandseq(t,T.maxIntBits(6)),C.bands(n,i,T.maxIntBits(5)),r=(0,S.default)(new Float32Array(i.shape[0]*3),[i.shape[0],3]),C.muls(r.pick(null,0),e,1/T.maxIntBits(5)),C.muls(r.pick(null,1),t,1/T.maxIntBits(6)),C.muls(r.pick(null,2),n,1/T.maxIntBits(5))}else{let e=(0,S.default)(new Uint16Array(i.shape[0]),[i.shape[0]]),t=(0,S.default)(new Uint16Array(i.shape[0]),[i.shape[0]]),n=(0,S.default)(new Uint16Array(i.shape[0]),[i.shape[0]]);C.rrshifts(e,i,21),C.rrshifts(t,i,11),C.bandseq(t,T.maxIntBits(10)),C.bands(n,i,T.maxIntBits(11)),r=(0,S.default)(new Float32Array(i.shape[0]*3),[i.shape[0],3]),C.muls(r.pick(null,0),e,1/T.maxIntBits(11)),C.muls(r.pick(null,1),t,1/T.maxIntBits(10)),C.muls(r.pick(null,2),n,1/T.maxIntBits(11))}return new w(r,e,t)}},E=class{constructor(e,t,n,r,i,a=!1){this._quantized=e,this._minMaxMatrix=t,this._chunkSize=n,this._quantizationMethod=r,this._variableChunkSize=i,this._isDynamicChunks=a}get length(){return this._quantized.shape[0]}get nchunks(){return this._minMaxMatrix.shape[0]}get quantized(){return this._quantized}get method(){return this._quantizationMethod}get minmaxMatrix(){return this._minMaxMatrix}_createPrunedMinMax(e){let t=e.length,n=this.minmaxMatrix.shape[0]-t,r=(0,b.default)(new Float32Array(n*2),[n,2]),i=0,a=n,o=0,s=this.minmaxMatrix.shape[0];for(let t=0;t<e.length;t++)s=e[t],a=s-o+i,a>i&&x.assign(r.hi(a,2).lo(i,0),this.minmaxMatrix.hi(s,2).lo(o,0)),i=a,o=s+1;return i<n&&x.assign(r.lo(i,0),this.minmaxMatrix.lo(o,0)),r}_createPrunedQuantized(e){let t=e.length,n=this.quantized.shape[0]-t,r=this._quantizationMethod,i,a;if(r===`norm8x`){a=this._quantized.shape[1];let e=a?n*a:n;i=(0,b.default)(new Uint8Array(e),a?[n,a]:[n,1])}else i=r===`norm565`?(0,b.default)(new Uint16Array(n),[n]):(0,b.default)(new Uint32Array(n),[n]);let o=0,s=n,c=0,l=i.shape[0];for(let t=0;t<e.length;t++)l=e[t],s=l-c+o,s>o&&(a?x.assign(i.hi(s,a).lo(o,0),this._quantized.hi(l,a).lo(c,0)):x.assign(i.hi(s).lo(o),this._quantized.hi(l).lo(c))),o=s,c=l+1;return o<n&&(a?x.assign(i.lo(o,0),this._quantized.lo(c,0)):x.assign(i.lo(o),this._quantized.lo(c))),i}pruneFeature(e,t,n){return new E(this._createPrunedQuantized(e),this._createPrunedMinMax(t),this._chunkSize,this._quantizationMethod,n,!0)}static getRequiredNChunks(e,t){return Math.floor(e/t)}static fromArray(e,t,n){let r=e.shape[0],i=Math.floor(r/n),a=(0,b.default)(new Float32Array(i*2),[i,2],[2,1]),o;o=t===`norm8x`?(0,b.default)(new Uint8Array(e.size),e.shape):t===`norm565`?(0,b.default)(new Uint16Array(e.shape[0]),[e.shape[0]]):(0,b.default)(new Uint32Array(e.shape[0]),[e.shape[0]]);for(let s=0;s<i;s++){let c=s*n,l=s+1<i?(s+1)*n:r,u;u=e.shape.length>1?w.createFromUnnormalized(e.hi(l,e.shape[1]).lo(c,0)):w.createFromUnnormalized(e.hi(l).lo(c)),a.set(s,0,u.minD),a.set(s,1,u.maxD),o.shape.length>1?x.assign(o.hi(l,o.shape[1]).lo(c,0),T.fromNormalized(u,t).quantized):x.assign(o.hi(l).lo(c),T.fromNormalized(u,t).quantized)}return new E(o,a,n,t)}denormDequant(){let e=this._minMaxMatrix.shape[0],t=this._quantized,n=t.shape[0],r=this._quantizationMethod,i=this._chunkSize,a;if(this._isDynamicChunks){if(!this._variableChunkSize)throw Error(`variable chunk must exists if chunkSize isDynamic`);a=this._variableChunkSize}let o;o=r===`norm8x`?(0,b.default)(new Float32Array(t.size),t.shape):(0,b.default)(new Float32Array(n*3),[n,3]);let s=0,c=i;for(let i=0;i<e;i++){let[l,u]=[this._minMaxMatrix.get(i,0),this._minMaxMatrix.get(i,1)];this._isDynamicChunks&&(c=a[i]);let d=i+1<e?s+c:n,f;f=t.shape.length>1?new T(t.hi(d,t.shape[1]).lo(s,0),r):new T(t.hi(d).lo(s),r),x.assign(o.hi(d,o.shape[1]).lo(s,0),f.dequantize(l,u).denormalize()),s=d}return o}static async fetchArrayBuffer(e){return await(await fetch(e,{mode:`cors`})).arrayBuffer()}},D=u(m(),1),O=u(y(),1),k=`http://127.0.0.1:8000`,A=u(m(),1),j=u(y(),1),M=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9];function N(e){return e<1e5?e<100?e<10?0:1:e<1e4?e<1e3?2:3:4:e<1e7?e<1e6?5:6:e<1e9?e<1e8?7:8:9}function P(e,t){if(e===t)return 0;if(~~e===e&&~~t===t){if(e===0||t===0)return e<t?-1:1;if(e<0||t<0){if(t>=0)return-1;if(e>=0)return 1;e=-e,t=-t}let n=N(e),r=N(t),i=0;return n<r?(e*=M[r-n-1],t/=10,i=-1):n>r&&(t*=M[n-r-1],e/=10,i=1),e===t?i:e<t?-1:1}let n=String(e),r=String(t);return n===r?0:n<r?-1:1}function F(e){let t=0;for(;e>=32;)t|=e&1,e>>=1;return e+t}function ee(e,t,n,r){let i=t+1;if(i===n)return 1;if(r(e[i++],e[t])<0){for(;i<n&&r(e[i],e[i-1])<0;)i++;te(e,t,i)}else for(;i<n&&r(e[i],e[i-1])>=0;)i++;return i-t}function te(e,t,n){for(n--;t<n;){let r=e[t];e[t++]=e[n],e[n--]=r}}function ne(e,t,n,r,i){for(r===t&&r++;r<n;r++){let n=e[r],a=t,o=r;for(;a<o;){let t=a+o>>>1;i(n,e[t])<0?o=t:a=t+1}let s=r-a;switch(s){case 3:e[a+3]=e[a+2];case 2:e[a+2]=e[a+1];case 1:e[a+1]=e[a];break;default:for(;s>0;)e[a+s]=e[a+s-1],s--}e[a]=n}}function I(e,t,n,r,i,a){let o=0,s=0,c=1;if(a(e,t[n+i])>0){for(s=r-i;c<s&&a(e,t[n+i+c])>0;)o=c,c=(c<<1)+1,c<=0&&(c=s);c>s&&(c=s),o+=i,c+=i}else{for(s=i+1;c<s&&a(e,t[n+i-c])<=0;)o=c,c=(c<<1)+1,c<=0&&(c=s);c>s&&(c=s);let r=o;o=i-c,c=i-r}for(o++;o<c;){let r=o+(c-o>>>1);a(e,t[n+r])>0?o=r+1:c=r}return c}function L(e,t,n,r,i,a){let o=0,s=0,c=1;if(a(e,t[n+i])<0){for(s=i+1;c<s&&a(e,t[n+i-c])<0;)o=c,c=(c<<1)+1,c<=0&&(c=s);c>s&&(c=s);let r=o;o=i-c,c=i-r}else{for(s=r-i;c<s&&a(e,t[n+i+c])>=0;)o=c,c=(c<<1)+1,c<=0&&(c=s);c>s&&(c=s),o+=i,c+=i}for(o++;o<c;){let r=o+(c-o>>>1);a(e,t[n+r])<0?c=r:o=r+1}return c}var re=class{constructor(e,t){d(this,`array`,null),d(this,`compare`,null),d(this,`minGallop`,7),d(this,`length`,0),d(this,`tmpStorageLength`,256),d(this,`stackLength`,0),d(this,`runStart`,null),d(this,`runLength`,null),d(this,`stackSize`,0),this.array=e,this.compare=t,this.length=e.length,this.length<2*256&&(this.tmpStorageLength=this.length>>>1),this.tmp=Array(this.tmpStorageLength),this.stackLength=this.length<120?5:this.length<1542?10:this.length<119151?19:40,this.runStart=Array(this.stackLength),this.runLength=Array(this.stackLength)}pushRun(e,t){this.runStart[this.stackSize]=e,this.runLength[this.stackSize]=t,this.stackSize+=1}mergeRuns(){for(;this.stackSize>1;){let e=this.stackSize-2;if(e>=1&&this.runLength[e-1]<=this.runLength[e]+this.runLength[e+1]||e>=2&&this.runLength[e-2]<=this.runLength[e]+this.runLength[e-1])this.runLength[e-1]<this.runLength[e+1]&&e--;else if(this.runLength[e]>this.runLength[e+1])break;this.mergeAt(e)}}forceMergeRuns(){for(;this.stackSize>1;){let e=this.stackSize-2;e>0&&this.runLength[e-1]<this.runLength[e+1]&&e--,this.mergeAt(e)}}mergeAt(e){let t=this.compare,n=this.array,r=this.runStart[e],i=this.runLength[e],a=this.runStart[e+1],o=this.runLength[e+1];this.runLength[e]=i+o,e===this.stackSize-3&&(this.runStart[e+1]=this.runStart[e+2],this.runLength[e+1]=this.runLength[e+2]),this.stackSize--;let s=L(n[a],n,r,i,0,t);r+=s,i-=s,i!==0&&(o=I(n[r+i-1],n,a,o,o-1,t),o!==0&&(i<=o?this.mergeLow(r,i,a,o):this.mergeHigh(r,i,a,o)))}mergeLow(e,t,n,r){let i=this.compare,a=this.array,o=this.tmp,s=0;for(s=0;s<t;s++)o[s]=a[e+s];let c=0,l=n,u=e;if(a[u++]=a[l++],--r===0){for(s=0;s<t;s++)a[u+s]=o[c+s];return}if(t===1){for(s=0;s<r;s++)a[u+s]=a[l+s];a[u+r]=o[c];return}let d=this.minGallop;for(;;){let e=0,n=0,f=!1;do if(i(a[l],o[c])<0){if(a[u++]=a[l++],n++,e=0,--r===0){f=!0;break}}else if(a[u++]=o[c++],e++,n=0,--t===1){f=!0;break}while((e|n)<d);if(f)break;do{if(e=L(a[l],o,c,t,0,i),e!==0){for(s=0;s<e;s++)a[u+s]=o[c+s];if(u+=e,c+=e,t-=e,t<=1){f=!0;break}}if(a[u++]=a[l++],--r===0){f=!0;break}if(n=I(o[c],a,l,r,0,i),n!==0){for(s=0;s<n;s++)a[u+s]=a[l+s];if(u+=n,l+=n,r-=n,r===0){f=!0;break}}if(a[u++]=o[c++],--t===1){f=!0;break}d--}while(e>=7||n>=7);if(f)break;d<0&&(d=0),d+=2}if(this.minGallop=d,d<1&&(this.minGallop=1),t===1){for(s=0;s<r;s++)a[u+s]=a[l+s];a[u+r]=o[c]}else{if(t===0)throw Error(`mergeLow preconditions were not respected`);for(s=0;s<t;s++)a[u+s]=o[c+s]}}mergeHigh(e,t,n,r){let i=this.compare,a=this.array,o=this.tmp,s=0;for(s=0;s<r;s++)o[s]=a[n+s];let c=e+t-1,l=r-1,u=n+r-1,d=0,f=0;if(a[u--]=a[c--],--t===0){for(d=u-(r-1),s=0;s<r;s++)a[d+s]=o[s];return}if(r===1){for(u-=t,c-=t,f=u+1,d=c+1,s=t-1;s>=0;s--)a[f+s]=a[d+s];a[u]=o[l];return}let p=this.minGallop;for(;;){let n=0,m=0,h=!1;do if(i(o[l],a[c])<0){if(a[u--]=a[c--],n++,m=0,--t===0){h=!0;break}}else if(a[u--]=o[l--],m++,n=0,--r===1){h=!0;break}while((n|m)<p);if(h)break;do{if(n=t-L(o[l],a,e,t,t-1,i),n!==0){for(u-=n,c-=n,t-=n,f=u+1,d=c+1,s=n-1;s>=0;s--)a[f+s]=a[d+s];if(t===0){h=!0;break}}if(a[u--]=o[l--],--r===1){h=!0;break}if(m=r-I(a[c],o,0,r,r-1,i),m!==0){for(u-=m,l-=m,r-=m,f=u+1,d=l+1,s=0;s<m;s++)a[f+s]=o[d+s];if(r<=1){h=!0;break}}if(a[u--]=a[c--],--t===0){h=!0;break}p--}while(n>=7||m>=7);if(h)break;p<0&&(p=0),p+=2}if(this.minGallop=p,p<1&&(this.minGallop=1),r===1){for(u-=t,c-=t,f=u+1,d=c+1,s=t-1;s>=0;s--)a[f+s]=a[d+s];a[u]=o[l]}else{if(r===0)throw Error(`mergeHigh preconditions were not respected`);for(d=u-(r-1),s=0;s<r;s++)a[d+s]=o[s]}}};function ie(e,t,n,r){if(!Array.isArray(e))throw TypeError(`Can only sort arrays`);t?typeof t!=`function`&&(r=n,n=t,t=P):t=P,n||=0,r||=e.length;let i=r-n;if(i<2)return;let a=0;if(i<32){a=ee(e,n,r,t),ne(e,n,r,n+a,t);return}let o=new re(e,t),s=F(i);do{if(a=ee(e,n,r,t),a<s){let r=i;r>s&&(r=s),ne(e,n,n+r,n+a,t),a=r}o.pushRun(n,a),o.mergeRuns(),i-=a,n+=a}while(i!==0);o.forceMergeRuns()}function R(e){let t=(0,A.default)(new Int32Array(e.shape[0]),[e.shape[0]]),n=(0,A.default)(new Int32Array(e.shape[0]),[e.shape[0]]);return j.bands(t,e,1023),j.lshifts(n,t,16),j.bxoreq(t,n),j.bandseq(t,4278190335),j.lshifts(n,t,8),j.bxoreq(t,n),j.bandseq(t,50393103),j.lshifts(n,t,4),j.bxoreq(t,n),j.bandseq(t,51130563),j.lshifts(n,t,2),j.bxoreq(t,n),j.bandseq(t,153391689),t}function ae(e){let t=R(e.pick(null,0)),n=R(e.pick(null,1));j.lshiftseq(n,1);let r=R(e.pick(null,2));return j.lshiftseq(r,2),j.boreq(t,n),j.boreq(t,r),t}function z(e,t){if(e.shape[0]!==t.shape[0])throw Error(`wrong length`);let n=(0,A.default)(new Float32Array(e.size),e.shape,e.stride,e.offset);for(let r=0;r<t.shape[0];r++){let i=t.get(r);if(e.shape.length>1)for(let t=0;t<e.shape[1];t++)n.set(r,t,e.get(i,t));else n.set(r,e.get(i))}return n}function oe(e){let t=j.sup(e),n=j.inf(e),r=1e3/Math.min(1e3,t-n),i=(0,A.default)(new Float32Array(e.data),e.shape);j.mulseq(i,r);let a=ae((0,A.default)(new Int32Array(i.data),e.shape)),o=Array.from(a.data).map((e,t)=>[e,t]);ie(o,(e,t)=>e[0]-t[0]);let s=o.map(([e,t])=>t);return(0,A.default)(Uint32Array.from(s))}var B=class{constructor(e,t,n,r,i,a,o,s,c,l){this.propertyDescs=e,this.format=t,this.nsplats=n,this.xyz=r,this.colors=i,this.harmonics=a,this.opacity=o,this.scaling=s,this.rotation=c,this.maxSHDegree=l}getPlyBinary(){let e=B._generateHeaderString(this.propertyDescs,this.format,this.nsplats),t=new TextEncoder().encode(e),n=Object.keys(this.propertyDescs).length,r=(0,D.default)(new Float32Array(this.nsplats*n),[this.nsplats,n]);if(O.assign(r.pick(null,this.propertyDescs.x.index),this.xyz.pick(null,0)),O.assign(r.pick(null,this.propertyDescs.y.index),this.xyz.pick(null,1)),O.assign(r.pick(null,this.propertyDescs.z.index),this.xyz.pick(null,2)),O.assign(r.pick(null,this.propertyDescs.f_dc_0.index),this.colors.pick(null,0)),O.assign(r.pick(null,this.propertyDescs.f_dc_1.index),this.colors.pick(null,1)),O.assign(r.pick(null,this.propertyDescs.f_dc_2.index),this.colors.pick(null,2)),O.assign(r.pick(null,this.propertyDescs.opacity.index),this.opacity.pick(null,0)),O.assign(r.pick(null,this.propertyDescs.scale_0.index),this.scaling.pick(null,0)),O.assign(r.pick(null,this.propertyDescs.scale_1.index),this.scaling.pick(null,1)),O.assign(r.pick(null,this.propertyDescs.scale_2.index),this.scaling.pick(null,2)),O.assign(r.pick(null,this.propertyDescs.rot_0.index),this.rotation.pick(null,0)),O.assign(r.pick(null,this.propertyDescs.rot_1.index),this.rotation.pick(null,1)),O.assign(r.pick(null,this.propertyDescs.rot_2.index),this.rotation.pick(null,2)),O.assign(r.pick(null,this.propertyDescs.rot_3.index),this.rotation.pick(null,3)),this.harmonics&&this.harmonics.length>0)for(let e=0;e<this.harmonics.length;e++){let t=e*3;O.assign(r.pick(null,this.propertyDescs[`f_rest_${t}`].index),this.harmonics[e].pick(null,0)),O.assign(r.pick(null,this.propertyDescs[`f_rest_${t+1}`].index),this.harmonics[e].pick(null,1)),O.assign(r.pick(null,this.propertyDescs[`f_rest_${t+2}`].index),this.harmonics[e].pick(null,2))}let i=new Uint8Array(r.data.buffer),a=new Uint8Array(i.length+t.length);return a.set(t),a.set(i,t.length),a.buffer}save(e,t){let n=this.getPlyBinary(),r=new Blob([n],{type:`application/octet-stream`}),i=new File([r],e),a=new FormData;a.append(`file`,i),a.append(`filename`,e),a.append(`basedir`,t),fetch(`${k}/push_file`,{method:`POST`,body:a})}static async loadFile(e){return await(await fetch(e)).arrayBuffer()}mortonPositionSplatsSort(){let e=oe(this.xyz),t=z(this.xyz,e),n=z(this.colors,e),r=z(this.opacity,e),i=z(this.scaling,e),a=z(this.rotation,e),o=[];for(let t=0;t<this.harmonics.length;t++)o.push(z(this.harmonics[t],e));return new B(this.propertyDescs,this.format,this.nsplats,t,n,o,r,i,a,this.maxSHDegree)}static _generateHeaderString(e,t,n){let r=`ply
format ${t.format} ${t.version}
element vertex ${n}`,i=Object.keys(e).length,a=Array(i);for(let t in e){let n=e[t];a[n.index]={name:t,dtype:n.dtype}}for(let e=0;e<a.length;e++)r=`${r}
property ${a[e].dtype} ${a[e].name}`;return`${r}
end_header
`}static fromArrayBuffer(e,t=3){let{splatCount:n,vertexData:r,propertiesDesc:i,format:a}=B.decodeHeader(e),o=r.buffer.slice(r.byteOffset),s=Object.keys(i).length,c=(0,D.default)(new Float32Array(o),[n,s]),l=0,u={},d={double:8,int:4,uint:4,float:4,short:2,ushort:2,uchar:1,char:1};for(let e in i)if(i.hasOwnProperty(e)){let t=i[e].dtype;u[e]=l,l+=d[t]}let f=(0,D.default)(new Float32Array(n*3),[n,3]);O.assign(f.pick(null,0),c.pick(null,u.x/4)),O.assign(f.pick(null,1),c.pick(null,u.y/4)),O.assign(f.pick(null,2),c.pick(null,u.z/4));let p=(0,D.default)(new Float32Array(n*3),[n,3]);O.assign(p.pick(null,0),c.pick(null,u.scale_0/4)),O.assign(p.pick(null,1),c.pick(null,u.scale_1/4)),O.assign(p.pick(null,2),c.pick(null,u.scale_2/4));let m=(0,D.default)(new Float32Array(n*3),[n,3]);O.assign(m.pick(null,0),c.pick(null,u.f_dc_0/4)),O.assign(m.pick(null,1),c.pick(null,u.f_dc_1/4)),O.assign(m.pick(null,2),c.pick(null,u.f_dc_2/4));let h=(0,D.default)(new Float32Array(n*4),[n,4]);O.assign(h.pick(null,0),c.pick(null,u.rot_1/4)),O.assign(h.pick(null,1),c.pick(null,u.rot_2/4)),O.assign(h.pick(null,2),c.pick(null,u.rot_3/4)),O.assign(h.pick(null,3),c.pick(null,u.rot_0/4));for(let e=0;e<n;e++){let t=h.pick(e,null),n=Math.sqrt(t.get(0)**2+t.get(1)**2+t.get(2)**2+t.get(3)**2);O.divseq(t,n)}let g=(0,D.default)(new Float32Array(n*1),[n,1]);O.assign(g.pick(null,0),c.pick(null,u.opacity/4)),O.negeq(g),O.expeq(g),O.addseq(g,1),O.recipeq(g),O.mulseq(g,255);let _=(Math.min(Math.max(t,0),3)+1)**2-1,v=[];for(let e=0;e<_;e++){let t=(0,D.default)(new Float32Array(n*3),[n,3]),r=e*3;O.assign(t.pick(null,0),c.pick(null,u[`f_rest_${r}`]/4)),O.assign(t.pick(null,1),c.pick(null,u[`f_rest_${r+1}`]/4)),O.assign(t.pick(null,2),c.pick(null,u[`f_rest_${r+2}`]/4)),v.push(t)}return new B(i,a,n,f,m,v,g,p,h,t)}static async fromPLYFile(e,t=3){let n=await B.loadFile(e);return B.fromArrayBuffer(n,t)}static decodeHeader(e){let t=new TextDecoder,n=0,r=``;for(;;){if(n+100>=e.byteLength)throw Error(`End of file reached while searching for end of header`);let i=new Uint8Array(e,n,100);r+=t.decode(i),n+=100;let a=n-200,o=new Uint8Array(e,Math.max(0,a),a>0?200:100);if(t.decode(o).includes(`end_header`))break}let i=r.split(`
`),a=0,o={},s={},c=0,l;for(let e=0;e<i.length;e++){let t=i[e].trim();if(t.startsWith(`element vertex`)){let e=t.match(/\d+/);e&&(a=parseInt(e[0]))}else if(t.startsWith(`property`)){let e=t.match(/(\w+)\s+(\w+)\s+(\w+)/);if(e){let t=e[2],n=e[3];o[n]=c,s[n]={dtype:t,index:c},c++}}else if(t.startsWith(`format`)){let e=t.match(/(\w+)\s+(\w+)\s+(\d+\.?\d*)/);e&&(l={format:e[2],version:e[3]})}else if(t===`end_header`)break}let u=r.indexOf(`end_header`)+10+1,d=new DataView(e,u);return{splatCount:a,vertexData:d,headerOffset:n,propertiesDesc:s,format:l}}},V=class{constructor(e,t,n,r,i,a,o,s){this.config=e,this.xyz=t,this.scaling=n,this.color=r,this.opacity=i,this.harmonics=o,this.quaternion=a,this.variableChunkSize=s}get isDynamicChunks(){return this.variableChunkSize&&this.variableChunkSize.length>0}get nchunks(){return this.xyz.nchunks}get nsplats(){return this.xyz.length}get chunkSize(){return this.config.chunkSize}static compressFromGaussianData(e,t){let n=E.fromArray(e.xyz,t.xyz,t.chunkSize),r=E.fromArray(e.scaling,t.scaling,t.chunkSize),i=E.fromArray(e.colors,t.color,t.chunkSize),a=E.fromArray(e.opacity,t.opacity,t.chunkSize),o=E.fromArray(e.rotation,t.quaternion,t.chunkSize),s=e.harmonics,c=[];if(t.harmonics)for(let e=0;e<s.length;e++){let n=E.fromArray(s[e],t.harmonics,t.chunkSize);c.push(n)}return new V(t,n,r,i,a,o,c)}_countIndexesInChunks(e){let t=[],n=this.nchunks,r=this.chunkSize,i=this.nsplats;if(n===E.getRequiredNChunks(i,r))for(let n=0;n<e.length;n++){let r=e[n],i=Math.floor(r/this.chunkSize);i in t?t[i].push(r):t[i]=[r]}else{let i=this.variableChunkSize,a={},o=0;for(let e=0;e<n;e++)a[e]=o,o+=i[e];for(let o=0;o<e.length;o++){let s=e[o],c=Math.min(Math.floor(s/r),n-1);for(;s>=a[c]+i[c];)c++;c in t?t[c].push(s):t[c]=[s]}}return t}pruneSplats(e){let t=this._countIndexesInChunks(e),n,r=[];return t.length>0&&(n=this.variableChunkSize?[...this.variableChunkSize]:Array(this.nchunks).fill(this.chunkSize),t.forEach((e,t)=>{n[t]-=e.length,n[t]<=0&&r.push(t)}),n=n.filter(e=>e>0)),new V(this.config,this.xyz.pruneFeature(e,r,n),this.scaling.pruneFeature(e,r,n),this.color.pruneFeature(e,r,n),this.opacity.pruneFeature(e,r,n),this.quaternion.pruneFeature(e,r,n),this.harmonics?this.harmonics.map(t=>t.pruneFeature(e,r,this.variableChunkSize)):void 0,n)}static async loadConfig(e){return await(await fetch(e,{method:`GET`,mode:`cors`,headers:{Accept:`application/json`}})).json()}toGaussians(){let e={format:`binary_little_endian`,version:`1.0`},t={},n=0;if(t.x={dtype:`float`,index:n},n++,t.y={dtype:`float`,index:n},n++,t.z={dtype:`float`,index:n},n++,t.f_dc_0={dtype:`float`,index:n},n++,t.f_dc_1={dtype:`float`,index:n},n++,t.f_dc_2={dtype:`float`,index:n},n++,this.harmonics&&this.harmonics.length>0)for(let e=0;e<this.harmonics.length;e++)t[`f_rest_${e}`]={dtype:`float`,index:n},n++,t[`f_rest_${e+1}`]={dtype:`float`,index:n},n++,t[`f_rest_${e+2}`]={dtype:`float`,index:n},n++;t.opacity={dtype:`float`,index:n},n++,t.scale_0={dtype:`float`,index:n},n++,t.scale_1={dtype:`float`,index:n},n++,t.scale_2={dtype:`float`,index:n},n++,t.rot_0={dtype:`float`,index:n},n++,t.rot_1={dtype:`float`,index:n},n++,t.rot_2={dtype:`float`,index:n},n++,t.rot_3={dtype:`float`,index:n},n++;let r=this.harmonics?.map(e=>e.denormDequant());return new B(t,e,this.xyz.length,this.xyz.denormDequant(),this.color.denormDequant(),r||[],this.opacity.denormDequant(),this.scaling.denormDequant(),this.quaternion.denormDequant(),3)}},H=u(m(),1),U=u(y(),1),W=1e-6,G=typeof Float32Array<`u`?Float32Array:Array,K=Math.random;Math.PI/180,Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var q={};c(q,{add:()=>je,adjoint:()=>ge,clone:()=>le,copy:()=>ue,create:()=>se,determinant:()=>_e,equals:()=>Ie,exactEquals:()=>Fe,frob:()=>Ae,fromMat2d:()=>Te,fromMat4:()=>ce,fromQuat:()=>Ee,fromRotation:()=>Ce,fromScaling:()=>we,fromTranslation:()=>Se,fromValues:()=>de,identity:()=>pe,invert:()=>he,mul:()=>Le,multiply:()=>ve,multiplyScalar:()=>Ne,multiplyScalarAndAdd:()=>Pe,normalFromMat4:()=>De,projection:()=>Oe,rotate:()=>be,scale:()=>xe,set:()=>fe,str:()=>ke,sub:()=>Re,subtract:()=>Me,translate:()=>ye,transpose:()=>me});function se(){var e=new G(9);return G!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function ce(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function le(e){var t=new G(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function ue(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function de(e,t,n,r,i,a,o,s,c){var l=new G(9);return l[0]=e,l[1]=t,l[2]=n,l[3]=r,l[4]=i,l[5]=a,l[6]=o,l[7]=s,l[8]=c,l}function fe(e,t,n,r,i,a,o,s,c,l){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=a,e[5]=o,e[6]=s,e[7]=c,e[8]=l,e}function pe(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function me(e,t){if(e===t){var n=t[1],r=t[2],i=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=r,e[7]=i}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function he(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],c=t[6],l=t[7],u=t[8],d=u*o-s*l,f=-u*a+s*c,p=l*a-o*c,m=n*d+r*f+i*p;return m?(m=1/m,e[0]=d*m,e[1]=(-u*r+i*l)*m,e[2]=(s*r-i*o)*m,e[3]=f*m,e[4]=(u*n-i*c)*m,e[5]=(-s*n+i*a)*m,e[6]=p*m,e[7]=(-l*n+r*c)*m,e[8]=(o*n-r*a)*m,e):null}function ge(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],c=t[6],l=t[7],u=t[8];return e[0]=o*u-s*l,e[1]=i*l-r*u,e[2]=r*s-i*o,e[3]=s*c-a*u,e[4]=n*u-i*c,e[5]=i*a-n*s,e[6]=a*l-o*c,e[7]=r*c-n*l,e[8]=n*o-r*a,e}function _e(e){var t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],c=e[7],l=e[8];return t*(l*a-o*c)+n*(-l*i+o*s)+r*(c*i-a*s)}function ve(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],c=t[5],l=t[6],u=t[7],d=t[8],f=n[0],p=n[1],m=n[2],h=n[3],g=n[4],_=n[5],v=n[6],y=n[7],b=n[8];return e[0]=f*r+p*o+m*l,e[1]=f*i+p*s+m*u,e[2]=f*a+p*c+m*d,e[3]=h*r+g*o+_*l,e[4]=h*i+g*s+_*u,e[5]=h*a+g*c+_*d,e[6]=v*r+y*o+b*l,e[7]=v*i+y*s+b*u,e[8]=v*a+y*c+b*d,e}function ye(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],c=t[5],l=t[6],u=t[7],d=t[8],f=n[0],p=n[1];return e[0]=r,e[1]=i,e[2]=a,e[3]=o,e[4]=s,e[5]=c,e[6]=f*r+p*o+l,e[7]=f*i+p*s+u,e[8]=f*a+p*c+d,e}function be(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],c=t[5],l=t[6],u=t[7],d=t[8],f=Math.sin(n),p=Math.cos(n);return e[0]=p*r+f*o,e[1]=p*i+f*s,e[2]=p*a+f*c,e[3]=p*o-f*r,e[4]=p*s-f*i,e[5]=p*c-f*a,e[6]=l,e[7]=u,e[8]=d,e}function xe(e,t,n){var r=n[0],i=n[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=i*t[3],e[4]=i*t[4],e[5]=i*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function Se(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function Ce(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=-n,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function we(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Te(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function Ee(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=n+n,s=r+r,c=i+i,l=n*o,u=r*o,d=r*s,f=i*o,p=i*s,m=i*c,h=a*o,g=a*s,_=a*c;return e[0]=1-d-m,e[3]=u-_,e[6]=f+g,e[1]=u+_,e[4]=1-l-m,e[7]=p-h,e[2]=f-g,e[5]=p+h,e[8]=1-l-d,e}function De(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],c=t[6],l=t[7],u=t[8],d=t[9],f=t[10],p=t[11],m=t[12],h=t[13],g=t[14],_=t[15],v=n*s-r*o,y=n*c-i*o,b=n*l-a*o,x=r*c-i*s,S=r*l-a*s,C=i*l-a*c,w=u*h-d*m,T=u*g-f*m,E=u*_-p*m,D=d*g-f*h,O=d*_-p*h,k=f*_-p*g,A=v*k-y*O+b*D+x*E-S*T+C*w;return A?(A=1/A,e[0]=(s*k-c*O+l*D)*A,e[1]=(c*E-o*k-l*T)*A,e[2]=(o*O-s*E+l*w)*A,e[3]=(i*O-r*k-a*D)*A,e[4]=(n*k-i*E+a*T)*A,e[5]=(r*E-n*O-a*w)*A,e[6]=(h*C-g*S+_*x)*A,e[7]=(g*b-m*C-_*y)*A,e[8]=(m*S-h*b+_*v)*A,e):null}function Oe(e,t,n){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/n,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function ke(e){return`mat3(`+e[0]+`, `+e[1]+`, `+e[2]+`, `+e[3]+`, `+e[4]+`, `+e[5]+`, `+e[6]+`, `+e[7]+`, `+e[8]+`)`}function Ae(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])}function je(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e}function Me(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e}function Ne(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e}function Pe(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e}function Fe(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function Ie(e,t){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],c=e[6],l=e[7],u=e[8],d=t[0],f=t[1],p=t[2],m=t[3],h=t[4],g=t[5],_=t[6],v=t[7],y=t[8];return Math.abs(n-d)<=W*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(r-f)<=W*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(i-p)<=W*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(a-m)<=W*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(o-h)<=W*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(s-g)<=W*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(c-_)<=W*Math.max(1,Math.abs(c),Math.abs(_))&&Math.abs(l-v)<=W*Math.max(1,Math.abs(l),Math.abs(v))&&Math.abs(u-y)<=W*Math.max(1,Math.abs(u),Math.abs(y))}var Le=ve,Re=Me,J={};c(J,{add:()=>Ot,adjoint:()=>qe,clone:()=>Be,copy:()=>Ve,create:()=>ze,determinant:()=>Je,equals:()=>Nt,exactEquals:()=>Mt,frob:()=>Dt,fromQuat:()=>ht,fromQuat2:()=>lt,fromRotation:()=>it,fromRotationTranslation:()=>ct,fromRotationTranslationScale:()=>pt,fromRotationTranslationScaleOrigin:()=>mt,fromScaling:()=>rt,fromTranslation:()=>nt,fromValues:()=>He,fromXRotation:()=>at,fromYRotation:()=>ot,fromZRotation:()=>st,frustum:()=>gt,getRotation:()=>ft,getScaling:()=>dt,getTranslation:()=>ut,identity:()=>We,invert:()=>Ke,lookAt:()=>wt,mul:()=>Pt,multiply:()=>Ye,multiplyScalar:()=>At,multiplyScalarAndAdd:()=>jt,ortho:()=>St,orthoNO:()=>xt,orthoZO:()=>Ct,perspective:()=>vt,perspectiveFromFieldOfView:()=>bt,perspectiveNO:()=>_t,perspectiveZO:()=>yt,rotate:()=>Qe,rotateX:()=>$e,rotateY:()=>et,rotateZ:()=>tt,scale:()=>Ze,set:()=>Ue,str:()=>Et,sub:()=>Ft,subtract:()=>kt,targetTo:()=>Tt,translate:()=>Xe,transpose:()=>Ge});function ze(){var e=new G(16);return G!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Be(e){var t=new G(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Ve(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function He(e,t,n,r,i,a,o,s,c,l,u,d,f,p,m,h){var g=new G(16);return g[0]=e,g[1]=t,g[2]=n,g[3]=r,g[4]=i,g[5]=a,g[6]=o,g[7]=s,g[8]=c,g[9]=l,g[10]=u,g[11]=d,g[12]=f,g[13]=p,g[14]=m,g[15]=h,g}function Ue(e,t,n,r,i,a,o,s,c,l,u,d,f,p,m,h,g){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=a,e[5]=o,e[6]=s,e[7]=c,e[8]=l,e[9]=u,e[10]=d,e[11]=f,e[12]=p,e[13]=m,e[14]=h,e[15]=g,e}function We(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ge(e,t){if(e===t){var n=t[1],r=t[2],i=t[3],a=t[6],o=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=a,e[11]=t[14],e[12]=i,e[13]=o,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function Ke(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],c=t[6],l=t[7],u=t[8],d=t[9],f=t[10],p=t[11],m=t[12],h=t[13],g=t[14],_=t[15],v=n*s-r*o,y=n*c-i*o,b=n*l-a*o,x=r*c-i*s,S=r*l-a*s,C=i*l-a*c,w=u*h-d*m,T=u*g-f*m,E=u*_-p*m,D=d*g-f*h,O=d*_-p*h,k=f*_-p*g,A=v*k-y*O+b*D+x*E-S*T+C*w;return A?(A=1/A,e[0]=(s*k-c*O+l*D)*A,e[1]=(i*O-r*k-a*D)*A,e[2]=(h*C-g*S+_*x)*A,e[3]=(f*S-d*C-p*x)*A,e[4]=(c*E-o*k-l*T)*A,e[5]=(n*k-i*E+a*T)*A,e[6]=(g*b-m*C-_*y)*A,e[7]=(u*C-f*b+p*y)*A,e[8]=(o*O-s*E+l*w)*A,e[9]=(r*E-n*O-a*w)*A,e[10]=(m*S-h*b+_*v)*A,e[11]=(d*b-u*S-p*v)*A,e[12]=(s*T-o*D-c*w)*A,e[13]=(n*D-r*T+i*w)*A,e[14]=(h*y-m*x-g*v)*A,e[15]=(u*x-d*y+f*v)*A,e):null}function qe(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],c=t[6],l=t[7],u=t[8],d=t[9],f=t[10],p=t[11],m=t[12],h=t[13],g=t[14],_=t[15];return e[0]=s*(f*_-p*g)-d*(c*_-l*g)+h*(c*p-l*f),e[1]=-(r*(f*_-p*g)-d*(i*_-a*g)+h*(i*p-a*f)),e[2]=r*(c*_-l*g)-s*(i*_-a*g)+h*(i*l-a*c),e[3]=-(r*(c*p-l*f)-s*(i*p-a*f)+d*(i*l-a*c)),e[4]=-(o*(f*_-p*g)-u*(c*_-l*g)+m*(c*p-l*f)),e[5]=n*(f*_-p*g)-u*(i*_-a*g)+m*(i*p-a*f),e[6]=-(n*(c*_-l*g)-o*(i*_-a*g)+m*(i*l-a*c)),e[7]=n*(c*p-l*f)-o*(i*p-a*f)+u*(i*l-a*c),e[8]=o*(d*_-p*h)-u*(s*_-l*h)+m*(s*p-l*d),e[9]=-(n*(d*_-p*h)-u*(r*_-a*h)+m*(r*p-a*d)),e[10]=n*(s*_-l*h)-o*(r*_-a*h)+m*(r*l-a*s),e[11]=-(n*(s*p-l*d)-o*(r*p-a*d)+u*(r*l-a*s)),e[12]=-(o*(d*g-f*h)-u*(s*g-c*h)+m*(s*f-c*d)),e[13]=n*(d*g-f*h)-u*(r*g-i*h)+m*(r*f-i*d),e[14]=-(n*(s*g-c*h)-o*(r*g-i*h)+m*(r*c-i*s)),e[15]=n*(s*f-c*d)-o*(r*f-i*d)+u*(r*c-i*s),e}function Je(e){var t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],c=e[7],l=e[8],u=e[9],d=e[10],f=e[11],p=e[12],m=e[13],h=e[14],g=e[15],_=t*o-n*a,v=t*s-r*a,y=t*c-i*a,b=n*s-r*o,x=n*c-i*o,S=r*c-i*s,C=l*m-u*p,w=l*h-d*p,T=l*g-f*p,E=u*h-d*m,D=u*g-f*m;return _*(d*g-f*h)-v*D+y*E+b*T-x*w+S*C}function Ye(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],c=t[5],l=t[6],u=t[7],d=t[8],f=t[9],p=t[10],m=t[11],h=t[12],g=t[13],_=t[14],v=t[15],y=n[0],b=n[1],x=n[2],S=n[3];return e[0]=y*r+b*s+x*d+S*h,e[1]=y*i+b*c+x*f+S*g,e[2]=y*a+b*l+x*p+S*_,e[3]=y*o+b*u+x*m+S*v,y=n[4],b=n[5],x=n[6],S=n[7],e[4]=y*r+b*s+x*d+S*h,e[5]=y*i+b*c+x*f+S*g,e[6]=y*a+b*l+x*p+S*_,e[7]=y*o+b*u+x*m+S*v,y=n[8],b=n[9],x=n[10],S=n[11],e[8]=y*r+b*s+x*d+S*h,e[9]=y*i+b*c+x*f+S*g,e[10]=y*a+b*l+x*p+S*_,e[11]=y*o+b*u+x*m+S*v,y=n[12],b=n[13],x=n[14],S=n[15],e[12]=y*r+b*s+x*d+S*h,e[13]=y*i+b*c+x*f+S*g,e[14]=y*a+b*l+x*p+S*_,e[15]=y*o+b*u+x*m+S*v,e}function Xe(e,t,n){var r=n[0],i=n[1],a=n[2],o,s,c,l,u,d,f,p,m,h,g,_;return t===e?(e[12]=t[0]*r+t[4]*i+t[8]*a+t[12],e[13]=t[1]*r+t[5]*i+t[9]*a+t[13],e[14]=t[2]*r+t[6]*i+t[10]*a+t[14],e[15]=t[3]*r+t[7]*i+t[11]*a+t[15]):(o=t[0],s=t[1],c=t[2],l=t[3],u=t[4],d=t[5],f=t[6],p=t[7],m=t[8],h=t[9],g=t[10],_=t[11],e[0]=o,e[1]=s,e[2]=c,e[3]=l,e[4]=u,e[5]=d,e[6]=f,e[7]=p,e[8]=m,e[9]=h,e[10]=g,e[11]=_,e[12]=o*r+u*i+m*a+t[12],e[13]=s*r+d*i+h*a+t[13],e[14]=c*r+f*i+g*a+t[14],e[15]=l*r+p*i+_*a+t[15]),e}function Ze(e,t,n){var r=n[0],i=n[1],a=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Qe(e,t,n,r){var i=r[0],a=r[1],o=r[2],s=Math.hypot(i,a,o),c,l,u,d,f,p,m,h,g,_,v,y,b,x,S,C,w,T,E,D,O,k,A,j;return s<W?null:(s=1/s,i*=s,a*=s,o*=s,c=Math.sin(n),l=Math.cos(n),u=1-l,d=t[0],f=t[1],p=t[2],m=t[3],h=t[4],g=t[5],_=t[6],v=t[7],y=t[8],b=t[9],x=t[10],S=t[11],C=i*i*u+l,w=a*i*u+o*c,T=o*i*u-a*c,E=i*a*u-o*c,D=a*a*u+l,O=o*a*u+i*c,k=i*o*u+a*c,A=a*o*u-i*c,j=o*o*u+l,e[0]=d*C+h*w+y*T,e[1]=f*C+g*w+b*T,e[2]=p*C+_*w+x*T,e[3]=m*C+v*w+S*T,e[4]=d*E+h*D+y*O,e[5]=f*E+g*D+b*O,e[6]=p*E+_*D+x*O,e[7]=m*E+v*D+S*O,e[8]=d*k+h*A+y*j,e[9]=f*k+g*A+b*j,e[10]=p*k+_*A+x*j,e[11]=m*k+v*A+S*j,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function $e(e,t,n){var r=Math.sin(n),i=Math.cos(n),a=t[4],o=t[5],s=t[6],c=t[7],l=t[8],u=t[9],d=t[10],f=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*i+l*r,e[5]=o*i+u*r,e[6]=s*i+d*r,e[7]=c*i+f*r,e[8]=l*i-a*r,e[9]=u*i-o*r,e[10]=d*i-s*r,e[11]=f*i-c*r,e}function et(e,t,n){var r=Math.sin(n),i=Math.cos(n),a=t[0],o=t[1],s=t[2],c=t[3],l=t[8],u=t[9],d=t[10],f=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*i-l*r,e[1]=o*i-u*r,e[2]=s*i-d*r,e[3]=c*i-f*r,e[8]=a*r+l*i,e[9]=o*r+u*i,e[10]=s*r+d*i,e[11]=c*r+f*i,e}function tt(e,t,n){var r=Math.sin(n),i=Math.cos(n),a=t[0],o=t[1],s=t[2],c=t[3],l=t[4],u=t[5],d=t[6],f=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*i+l*r,e[1]=o*i+u*r,e[2]=s*i+d*r,e[3]=c*i+f*r,e[4]=l*i-a*r,e[5]=u*i-o*r,e[6]=d*i-s*r,e[7]=f*i-c*r,e}function nt(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function rt(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function it(e,t,n){var r=n[0],i=n[1],a=n[2],o=Math.hypot(r,i,a),s,c,l;return o<W?null:(o=1/o,r*=o,i*=o,a*=o,s=Math.sin(t),c=Math.cos(t),l=1-c,e[0]=r*r*l+c,e[1]=i*r*l+a*s,e[2]=a*r*l-i*s,e[3]=0,e[4]=r*i*l-a*s,e[5]=i*i*l+c,e[6]=a*i*l+r*s,e[7]=0,e[8]=r*a*l+i*s,e[9]=i*a*l-r*s,e[10]=a*a*l+c,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function at(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ot(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function st(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ct(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=r+r,c=i+i,l=a+a,u=r*s,d=r*c,f=r*l,p=i*c,m=i*l,h=a*l,g=o*s,_=o*c,v=o*l;return e[0]=1-(p+h),e[1]=d+v,e[2]=f-_,e[3]=0,e[4]=d-v,e[5]=1-(u+h),e[6]=m+g,e[7]=0,e[8]=f+_,e[9]=m-g,e[10]=1-(u+p),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function lt(e,t){var n=new G(3),r=-t[0],i=-t[1],a=-t[2],o=t[3],s=t[4],c=t[5],l=t[6],u=t[7],d=r*r+i*i+a*a+o*o;return d>0?(n[0]=(s*o+u*r+c*a-l*i)*2/d,n[1]=(c*o+u*i+l*r-s*a)*2/d,n[2]=(l*o+u*a+s*i-c*r)*2/d):(n[0]=(s*o+u*r+c*a-l*i)*2,n[1]=(c*o+u*i+l*r-s*a)*2,n[2]=(l*o+u*a+s*i-c*r)*2),ct(e,t,n),e}function ut(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function dt(e,t){var n=t[0],r=t[1],i=t[2],a=t[4],o=t[5],s=t[6],c=t[8],l=t[9],u=t[10];return e[0]=Math.hypot(n,r,i),e[1]=Math.hypot(a,o,s),e[2]=Math.hypot(c,l,u),e}function ft(e,t){var n=new G(3);dt(n,t);var r=1/n[0],i=1/n[1],a=1/n[2],o=t[0]*r,s=t[1]*i,c=t[2]*a,l=t[4]*r,u=t[5]*i,d=t[6]*a,f=t[8]*r,p=t[9]*i,m=t[10]*a,h=o+u+m,g=0;return h>0?(g=Math.sqrt(h+1)*2,e[3]=.25*g,e[0]=(d-p)/g,e[1]=(f-c)/g,e[2]=(s-l)/g):o>u&&o>m?(g=Math.sqrt(1+o-u-m)*2,e[3]=(d-p)/g,e[0]=.25*g,e[1]=(s+l)/g,e[2]=(f+c)/g):u>m?(g=Math.sqrt(1+u-o-m)*2,e[3]=(f-c)/g,e[0]=(s+l)/g,e[1]=.25*g,e[2]=(d+p)/g):(g=Math.sqrt(1+m-o-u)*2,e[3]=(s-l)/g,e[0]=(f+c)/g,e[1]=(d+p)/g,e[2]=.25*g),e}function pt(e,t,n,r){var i=t[0],a=t[1],o=t[2],s=t[3],c=i+i,l=a+a,u=o+o,d=i*c,f=i*l,p=i*u,m=a*l,h=a*u,g=o*u,_=s*c,v=s*l,y=s*u,b=r[0],x=r[1],S=r[2];return e[0]=(1-(m+g))*b,e[1]=(f+y)*b,e[2]=(p-v)*b,e[3]=0,e[4]=(f-y)*x,e[5]=(1-(d+g))*x,e[6]=(h+_)*x,e[7]=0,e[8]=(p+v)*S,e[9]=(h-_)*S,e[10]=(1-(d+m))*S,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function mt(e,t,n,r,i){var a=t[0],o=t[1],s=t[2],c=t[3],l=a+a,u=o+o,d=s+s,f=a*l,p=a*u,m=a*d,h=o*u,g=o*d,_=s*d,v=c*l,y=c*u,b=c*d,x=r[0],S=r[1],C=r[2],w=i[0],T=i[1],E=i[2],D=(1-(h+_))*x,O=(p+b)*x,k=(m-y)*x,A=(p-b)*S,j=(1-(f+_))*S,M=(g+v)*S,N=(m+y)*C,P=(g-v)*C,F=(1-(f+h))*C;return e[0]=D,e[1]=O,e[2]=k,e[3]=0,e[4]=A,e[5]=j,e[6]=M,e[7]=0,e[8]=N,e[9]=P,e[10]=F,e[11]=0,e[12]=n[0]+w-(D*w+A*T+N*E),e[13]=n[1]+T-(O*w+j*T+P*E),e[14]=n[2]+E-(k*w+M*T+F*E),e[15]=1,e}function ht(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=n+n,s=r+r,c=i+i,l=n*o,u=r*o,d=r*s,f=i*o,p=i*s,m=i*c,h=a*o,g=a*s,_=a*c;return e[0]=1-d-m,e[1]=u+_,e[2]=f-g,e[3]=0,e[4]=u-_,e[5]=1-l-m,e[6]=p+h,e[7]=0,e[8]=f+g,e[9]=p-h,e[10]=1-l-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function gt(e,t,n,r,i,a,o){var s=1/(n-t),c=1/(i-r),l=1/(a-o);return e[0]=a*2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a*2*c,e[6]=0,e[7]=0,e[8]=(n+t)*s,e[9]=(i+r)*c,e[10]=(o+a)*l,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*a*2*l,e[15]=0,e}function _t(e,t,n,r,i){var a=1/Math.tan(t/2),o;return e[0]=a/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==1/0?(o=1/(r-i),e[10]=(i+r)*o,e[14]=2*i*r*o):(e[10]=-1,e[14]=-2*r),e}var vt=_t;function yt(e,t,n,r,i){var a=1/Math.tan(t/2),o;return e[0]=a/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==1/0?(o=1/(r-i),e[10]=i*o,e[14]=i*r*o):(e[10]=-1,e[14]=-r),e}function bt(e,t,n,r){var i=Math.tan(t.upDegrees*Math.PI/180),a=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),c=2/(o+s),l=2/(i+a);return e[0]=c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=l,e[6]=0,e[7]=0,e[8]=-((o-s)*c*.5),e[9]=(i-a)*l*.5,e[10]=r/(n-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*n/(n-r),e[15]=0,e}function xt(e,t,n,r,i,a,o){var s=1/(t-n),c=1/(r-i),l=1/(a-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(t+n)*s,e[13]=(i+r)*c,e[14]=(o+a)*l,e[15]=1,e}var St=xt;function Ct(e,t,n,r,i,a,o){var s=1/(t-n),c=1/(r-i),l=1/(a-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=l,e[11]=0,e[12]=(t+n)*s,e[13]=(i+r)*c,e[14]=a*l,e[15]=1,e}function wt(e,t,n,r){var i,a,o,s,c,l,u,d,f,p,m=t[0],h=t[1],g=t[2],_=r[0],v=r[1],y=r[2],b=n[0],x=n[1],S=n[2];return Math.abs(m-b)<W&&Math.abs(h-x)<W&&Math.abs(g-S)<W?We(e):(u=m-b,d=h-x,f=g-S,p=1/Math.hypot(u,d,f),u*=p,d*=p,f*=p,i=v*f-y*d,a=y*u-_*f,o=_*d-v*u,p=Math.hypot(i,a,o),p?(p=1/p,i*=p,a*=p,o*=p):(i=0,a=0,o=0),s=d*o-f*a,c=f*i-u*o,l=u*a-d*i,p=Math.hypot(s,c,l),p?(p=1/p,s*=p,c*=p,l*=p):(s=0,c=0,l=0),e[0]=i,e[1]=s,e[2]=u,e[3]=0,e[4]=a,e[5]=c,e[6]=d,e[7]=0,e[8]=o,e[9]=l,e[10]=f,e[11]=0,e[12]=-(i*m+a*h+o*g),e[13]=-(s*m+c*h+l*g),e[14]=-(u*m+d*h+f*g),e[15]=1,e)}function Tt(e,t,n,r){var i=t[0],a=t[1],o=t[2],s=r[0],c=r[1],l=r[2],u=i-n[0],d=a-n[1],f=o-n[2],p=u*u+d*d+f*f;p>0&&(p=1/Math.sqrt(p),u*=p,d*=p,f*=p);var m=c*f-l*d,h=l*u-s*f,g=s*d-c*u;return p=m*m+h*h+g*g,p>0&&(p=1/Math.sqrt(p),m*=p,h*=p,g*=p),e[0]=m,e[1]=h,e[2]=g,e[3]=0,e[4]=d*g-f*h,e[5]=f*m-u*g,e[6]=u*h-d*m,e[7]=0,e[8]=u,e[9]=d,e[10]=f,e[11]=0,e[12]=i,e[13]=a,e[14]=o,e[15]=1,e}function Et(e){return`mat4(`+e[0]+`, `+e[1]+`, `+e[2]+`, `+e[3]+`, `+e[4]+`, `+e[5]+`, `+e[6]+`, `+e[7]+`, `+e[8]+`, `+e[9]+`, `+e[10]+`, `+e[11]+`, `+e[12]+`, `+e[13]+`, `+e[14]+`, `+e[15]+`)`}function Dt(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Ot(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e}function kt(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e}function At(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12]*n,e[13]=t[13]*n,e[14]=t[14]*n,e[15]=t[15]*n,e}function jt(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e[9]=t[9]+n[9]*r,e[10]=t[10]+n[10]*r,e[11]=t[11]+n[11]*r,e[12]=t[12]+n[12]*r,e[13]=t[13]+n[13]*r,e[14]=t[14]+n[14]*r,e[15]=t[15]+n[15]*r,e}function Mt(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function Nt(e,t){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],c=e[6],l=e[7],u=e[8],d=e[9],f=e[10],p=e[11],m=e[12],h=e[13],g=e[14],_=e[15],v=t[0],y=t[1],b=t[2],x=t[3],S=t[4],C=t[5],w=t[6],T=t[7],E=t[8],D=t[9],O=t[10],k=t[11],A=t[12],j=t[13],M=t[14],N=t[15];return Math.abs(n-v)<=W*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(r-y)<=W*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(i-b)<=W*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(a-x)<=W*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(o-S)<=W*Math.max(1,Math.abs(o),Math.abs(S))&&Math.abs(s-C)<=W*Math.max(1,Math.abs(s),Math.abs(C))&&Math.abs(c-w)<=W*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(l-T)<=W*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(u-E)<=W*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(d-D)<=W*Math.max(1,Math.abs(d),Math.abs(D))&&Math.abs(f-O)<=W*Math.max(1,Math.abs(f),Math.abs(O))&&Math.abs(p-k)<=W*Math.max(1,Math.abs(p),Math.abs(k))&&Math.abs(m-A)<=W*Math.max(1,Math.abs(m),Math.abs(A))&&Math.abs(h-j)<=W*Math.max(1,Math.abs(h),Math.abs(j))&&Math.abs(g-M)<=W*Math.max(1,Math.abs(g),Math.abs(M))&&Math.abs(_-N)<=W*Math.max(1,Math.abs(_),Math.abs(N))}var Pt=Ye,Ft=kt,Y={};c(Y,{add:()=>Tn,calculateW:()=>dn,clone:()=>xn,conjugate:()=>_n,copy:()=>Cn,create:()=>Z,dot:()=>On,equals:()=>Fn,exactEquals:()=>Pn,exp:()=>fn,fromEuler:()=>yn,fromMat3:()=>vn,fromValues:()=>Sn,getAngle:()=>on,getAxisAngle:()=>an,identity:()=>nn,invert:()=>gn,len:()=>jn,length:()=>An,lerp:()=>kn,ln:()=>pn,mul:()=>En,multiply:()=>sn,normalize:()=>$,pow:()=>mn,random:()=>hn,rotateX:()=>cn,rotateY:()=>ln,rotateZ:()=>un,rotationTo:()=>In,scale:()=>Dn,set:()=>wn,setAxes:()=>Rn,setAxisAngle:()=>rn,slerp:()=>Q,sqlerp:()=>Ln,sqrLen:()=>Nn,squaredLength:()=>Mn,str:()=>bn});function It(){var e=new G(3);return G!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Lt(e){var t=e[0],n=e[1],r=e[2];return Math.hypot(t,n,r)}function Rt(e,t,n){var r=new G(3);return r[0]=e,r[1]=t,r[2]=n,r}function zt(e,t){var n=t[0],r=t[1],i=t[2],a=n*n+r*r+i*i;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e}function Bt(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function X(e,t,n){var r=t[0],i=t[1],a=t[2],o=n[0],s=n[1],c=n[2];return e[0]=i*c-a*s,e[1]=a*o-r*c,e[2]=r*s-i*o,e}var Vt=Lt;(function(){var e=It();return function(t,n,r,i,a,o){var s,c;for(n||=3,r||=0,c=i?Math.min(i*n+r,t.length):t.length,s=r;s<c;s+=n)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],a(e,e,o),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2];return t}})();function Ht(){var e=new G(4);return G!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Ut(e){var t=new G(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Wt(e,t,n,r){var i=new G(4);return i[0]=e,i[1]=t,i[2]=n,i[3]=r,i}function Gt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Kt(e,t,n,r,i){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e}function qt(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e}function Jt(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function Yt(e){var t=e[0],n=e[1],r=e[2],i=e[3];return Math.hypot(t,n,r,i)}function Xt(e){var t=e[0],n=e[1],r=e[2],i=e[3];return t*t+n*n+r*r+i*i}function Zt(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=n*n+r*r+i*i+a*a;return o>0&&(o=1/Math.sqrt(o)),e[0]=n*o,e[1]=r*o,e[2]=i*o,e[3]=a*o,e}function Qt(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function $t(e,t,n,r){var i=t[0],a=t[1],o=t[2],s=t[3];return e[0]=i+r*(n[0]-i),e[1]=a+r*(n[1]-a),e[2]=o+r*(n[2]-o),e[3]=s+r*(n[3]-s),e}function en(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function tn(e,t){var n=e[0],r=e[1],i=e[2],a=e[3],o=t[0],s=t[1],c=t[2],l=t[3];return Math.abs(n-o)<=W*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-s)<=W*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-c)<=W*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(a-l)<=W*Math.max(1,Math.abs(a),Math.abs(l))}(function(){var e=Ht();return function(t,n,r,i,a,o){var s,c;for(n||=4,r||=0,c=i?Math.min(i*n+r,t.length):t.length,s=r;s<c;s+=n)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],e[3]=t[s+3],a(e,e,o),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2],t[s+3]=e[3];return t}})();function Z(){var e=new G(4);return G!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function nn(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function rn(e,t,n){n*=.5;var r=Math.sin(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n),e}function an(e,t){var n=Math.acos(t[3])*2,r=Math.sin(n/2);return r>W?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),n}function on(e,t){var n=On(e,t);return Math.acos(2*n*n-1)}function sn(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=n[0],c=n[1],l=n[2],u=n[3];return e[0]=r*u+o*s+i*l-a*c,e[1]=i*u+o*c+a*s-r*l,e[2]=a*u+o*l+r*c-i*s,e[3]=o*u-r*s-i*c-a*l,e}function cn(e,t,n){n*=.5;var r=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(n),c=Math.cos(n);return e[0]=r*c+o*s,e[1]=i*c+a*s,e[2]=a*c-i*s,e[3]=o*c-r*s,e}function ln(e,t,n){n*=.5;var r=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(n),c=Math.cos(n);return e[0]=r*c-a*s,e[1]=i*c+o*s,e[2]=a*c+r*s,e[3]=o*c-i*s,e}function un(e,t,n){n*=.5;var r=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(n),c=Math.cos(n);return e[0]=r*c+i*s,e[1]=i*c-r*s,e[2]=a*c+o*s,e[3]=o*c-a*s,e}function dn(e,t){var n=t[0],r=t[1],i=t[2];return e[0]=n,e[1]=r,e[2]=i,e[3]=Math.sqrt(Math.abs(1-n*n-r*r-i*i)),e}function fn(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=Math.sqrt(n*n+r*r+i*i),s=Math.exp(a),c=o>0?s*Math.sin(o)/o:0;return e[0]=n*c,e[1]=r*c,e[2]=i*c,e[3]=s*Math.cos(o),e}function pn(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=Math.sqrt(n*n+r*r+i*i),s=o>0?Math.atan2(o,a)/o:0;return e[0]=n*s,e[1]=r*s,e[2]=i*s,e[3]=.5*Math.log(n*n+r*r+i*i+a*a),e}function mn(e,t,n){return pn(e,t),Dn(e,e,n),fn(e,e),e}function Q(e,t,n,r){var i=t[0],a=t[1],o=t[2],s=t[3],c=n[0],l=n[1],u=n[2],d=n[3],f,p,m,h,g;return p=i*c+a*l+o*u+s*d,p<0&&(p=-p,c=-c,l=-l,u=-u,d=-d),1-p>W?(f=Math.acos(p),m=Math.sin(f),h=Math.sin((1-r)*f)/m,g=Math.sin(r*f)/m):(h=1-r,g=r),e[0]=h*i+g*c,e[1]=h*a+g*l,e[2]=h*o+g*u,e[3]=h*s+g*d,e}function hn(e){var t=K(),n=K(),r=K(),i=Math.sqrt(1-t),a=Math.sqrt(t);return e[0]=i*Math.sin(2*Math.PI*n),e[1]=i*Math.cos(2*Math.PI*n),e[2]=a*Math.sin(2*Math.PI*r),e[3]=a*Math.cos(2*Math.PI*r),e}function gn(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=n*n+r*r+i*i+a*a,s=o?1/o:0;return e[0]=-n*s,e[1]=-r*s,e[2]=-i*s,e[3]=a*s,e}function _n(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function vn(e,t){var n=t[0]+t[4]+t[8],r;if(n>0)r=Math.sqrt(n+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{var i=0;t[4]>t[0]&&(i=1),t[8]>t[i*3+i]&&(i=2);var a=(i+1)%3,o=(i+2)%3;r=Math.sqrt(t[i*3+i]-t[a*3+a]-t[o*3+o]+1),e[i]=.5*r,r=.5/r,e[3]=(t[a*3+o]-t[o*3+a])*r,e[a]=(t[a*3+i]+t[i*3+a])*r,e[o]=(t[o*3+i]+t[i*3+o])*r}return e}function yn(e,t,n,r){var i=.5*Math.PI/180;t*=i,n*=i,r*=i;var a=Math.sin(t),o=Math.cos(t),s=Math.sin(n),c=Math.cos(n),l=Math.sin(r),u=Math.cos(r);return e[0]=a*c*u-o*s*l,e[1]=o*s*u+a*c*l,e[2]=o*c*l-a*s*u,e[3]=o*c*u+a*s*l,e}function bn(e){return`quat(`+e[0]+`, `+e[1]+`, `+e[2]+`, `+e[3]+`)`}var xn=Ut,Sn=Wt,Cn=Gt,wn=Kt,Tn=qt,En=sn,Dn=Jt,On=Qt,kn=$t,An=Yt,jn=An,Mn=Xt,Nn=Mn,$=Zt,Pn=en,Fn=tn,In=function(){var e=It(),t=Rt(1,0,0),n=Rt(0,1,0);return function(r,i,a){var o=Bt(i,a);return o<-.999999?(X(e,t,i),Vt(e)<1e-6&&X(e,n,i),zt(e,e),rn(r,e,Math.PI),r):o>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(X(e,i,a),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=1+o,$(r,r))}}(),Ln=function(){var e=Z(),t=Z();return function(n,r,i,a,o,s){return Q(e,r,o,s),Q(t,i,a,s),Q(n,e,t,2*s*(1-s)),n}}(),Rn=function(){var e=se();return function(t,n,r,i){return e[0]=r[0],e[3]=r[1],e[6]=r[2],e[1]=i[0],e[4]=i[1],e[7]=i[2],e[2]=-n[0],e[5]=-n[1],e[8]=-n[2],$(t,vn(t,e))}}(),zn={xyz:3,color:3,opacity:1,scaling:3,quaternion:4,harmonics:3},Bn=class{constructor(e){this.version=``,this._buffer=e}get buffer(){return this._buffer}get decoded(){return this._decoded||=this.decodeBuffer(),this._decoded}get colorsA(){let e=this.decoded.color.denormDequant(),t=this.decoded.opacity.denormDequant(),n=(0,H.default)(new Float32Array(e.shape[0]*4),[e.shape[0],4]);return U.mulseq(e,.28209479177387814),U.addseq(e,.5),U.mulseq(e,255),U.maxseq(e,0),U.minseq(e,255),this.version===``&&(U.negeq(t),U.expeq(t),U.addseq(t,1),U.recipeq(t),U.mulseq(t,255)),U.assign(n.hi(e.shape[0],3).lo(0,0),e),U.assign(n.hi(e.shape[0],4).lo(0,3),t),(0,H.default)(new Uint8Array(n.data),[e.shape[0],4]).data}get nsplats(){return this.decoded.nsplats}getSplatCount(){return this.decoded.nsplats}get precomputedCovarianceBufferData(){return this._precomputedCovarianceBufferData}decodeBuffer(){let{splatCount:e,chunkCount:t,chunkSize:n,typeChunks:r,vertexData:i,propertiesDesc:a,version:o}=this.decodeHeader();this.version=o;let s={xyz:a.xyz.compressionMethod,color:a.color.compressionMethod,opacity:a.opacity.compressionMethod,scaling:a.scaling.compressionMethod,quaternion:a.quaternion.compressionMethod,chunkSize:n};a.harmonics_0&&(s.harmonics=a.harmonics_0.compressionMethod);let c=i.byteOffset,l=Array(Object.keys(a).length);for(let e in a)l[a[e].index]={name:e,method:a[e].compressionMethod};let u=t*2*4,d=c,f=r===`dynamic`?t*2:0,p,m=!1;if(f>0){let e=new Uint16Array(i.buffer.slice(d,d+f));d+=f,p=Array.from(e),m=!0}let h={};for(let r of l){let a=0,o=!0;if(r.method===`norm8x`)a=e*1*zn[r.name];else if(r.method===`norm11`)a=e*4;else if(r.method===`norm565`)a=e*2;else throw o=!1,Error(`Not Implemented format: ${r.method}`);let s;if(o){let e=i.buffer.slice(d,d+u);s=(0,H.default)(new Float32Array(e),[t,2]),d+=u}else throw Error(`loading chunk byt hasnot minmax!`);let c=i.buffer.slice(d,d+a);d+=a;let l;if(r.method===`norm8x`)l=(0,H.default)(new Uint8Array(c),[e,zn[r.name]]);else if(r.method===`norm11`)l=(0,H.default)(new Uint32Array(c));else if(r.method===`norm565`)l=(0,H.default)(new Uint16Array(c));else throw Error(`Not Implemented format: ${r.method}`);h[r.name]=new E(l,s,n,r.method,p,m)}let g=[];for(let e=0;e<15;e++){let t=h[`harmonics_${e}`];t&&(g.push(t),delete h[`harmonics_${e}`])}return g.length>0&&(h.harmonics=g),new V(s,h.xyz,h.scaling,h.color,h.opacity,h.quaternion,h.harmonics,p)}buildPreComputedBuffers(){let e=this.decoded,t=e.nsplats,n=new ArrayBuffer(24*t),r=new Float32Array(n),i=e.scaling.denormDequant(),a=e.quaternion.denormDequant(),o=Y.create(),s=q.create(),c=q.create(),l=q.create(),u=J.create();for(let e=0;e<t;e++){J.fromScaling(u,[Math.exp(i.get(e,0)),Math.exp(i.get(e,1)),Math.exp(i.get(e,2))]),q.fromMat4(c,u),Y.set(o,a.get(e,0),a.get(e,1),a.get(e,2),a.get(e,3)),q.fromQuat(s,o),q.multiply(l,s,c);let t=l;r[6*e]=t[0]*t[0]+t[3]*t[3]+t[6]*t[6],r[6*e+1]=t[0]*t[1]+t[3]*t[4]+t[6]*t[7],r[6*e+2]=t[0]*t[2]+t[3]*t[5]+t[6]*t[8],r[6*e+3]=t[1]*t[1]+t[4]*t[4]+t[7]*t[7],r[6*e+4]=t[1]*t[2]+t[4]*t[5]+t[7]*t[8],r[6*e+5]=t[2]*t[2]+t[5]*t[5]+t[8]*t[8]}this._precomputedCovarianceBufferData=n}decodeHeader(){let e=this._buffer,t=new TextDecoder,n=0,r=``;for(;;){if(n+100>=e.byteLength)throw Error(`End of file reached while searching for end of header`);let i=new Uint8Array(e,n,100);r+=t.decode(i),n+=100;let a=n-200,o=new Uint8Array(e,Math.max(0,a),a>=0?200:100);if(t.decode(o).includes(`end_header`))break}let i=r.split(`
`),a=0,o=0,s=0,c=0,l=``,u=``,d={};for(let e=0;e<i.length;e++){let t=i[e].trim();if(t.startsWith(`version`))u=t.split(` `)[1]??``;else if(t.startsWith(`element vertex`)){let e=t.match(/\d+/);e&&(a=parseInt(e[0]))}else if(t.startsWith(`property`)){let e=t.match(/(\w+)\s+(\w+)\s+(\w+)/);if(e){let t=e[2];d[t]={compressionMethod:e[3],index:c},c++}}else if(t.startsWith(`element chunks`)){let e=t.match(/\d+/);e&&(o=parseInt(e[0]))}else if(t.startsWith(`element chunkSize`)){let e=t.match(/\d+/);e&&(s=parseInt(e[0]))}else if(t.startsWith(`element typeChunks`)){let e=t.match(/(\w+)\s+(\w+)\s+(\w+)/);e&&(l=e[3])}else if(t===`end_header`)break}let f=r.indexOf(`end_header`)+10+1,p=new DataView(e,f);return{splatCount:a,chunkCount:o,chunkSize:s,typeChunks:l,vertexData:p,propertiesDesc:d,version:u}}pruneSplats(e){let t=this.decodeBuffer().pruneSplats(e);return Bn.fromCompressedGaussianSplats(t,this.version)}static fromCompressedGaussianSplats(e,t){let n=e.xyz.length,r=e.xyz.nchunks,i=`gspline
version ${t}
element vertex ${n}
element chunks ${r}
element chunkSize ${e.chunkSize}
element typeChunks ${e.isDynamicChunks?`dynamic`:`static`}
property xyz ${e.xyz.method}
property color ${e.color.method}
property opacity ${e.opacity.method}
property scaling ${e.scaling.method}
property quaternion ${e.quaternion.method}`;if(e.harmonics&&e.harmonics.length>0)for(let t=0;t<e.harmonics.length;t++)i=`${i}
property harmonics_${t} ${e.harmonics[t].method}`;i=`${i}
end_header
`;let a=new TextEncoder().encode(i),o=r*2*4,s=e.xyz.quantized.data.buffer.byteLength,c=e.xyz instanceof E?o:0,l=e.color.quantized.data.buffer.byteLength,u=e.color instanceof E?o:0,d=e.opacity.quantized.data.buffer.byteLength,f=e.opacity instanceof E?o:0,p=e.scaling.quantized.data.buffer.byteLength,m=e.scaling instanceof E?o:0,h=e.quaternion.quantized.data.buffer.byteLength,g=e.quaternion instanceof E?o:0,_=e.variableChunkSize?Uint16Array.from(e.variableChunkSize):void 0,v=_?_.byteLength:0,y=a.byteLength+v+s+c+l+u+d+f+p+m+h+g,b=0,x=0;if(e.harmonics&&e.harmonics.length>0)for(let t=0;t<e.harmonics.length;t++)b+=e.harmonics[t].quantized.data.buffer.byteLength,x+=e.harmonics[t]instanceof E?o:0;b=0,x=0,y+=b+x;let S=new Uint8Array(y),C=0;if(S.set(a,C),C+=a.byteLength,v>0&&(S.set(new Uint8Array(_.buffer),C),C+=v),e.xyz instanceof E&&(S.set(new Uint8Array(e.xyz.minmaxMatrix.data.buffer),C),C+=o),S.set(new Uint8Array(e.xyz.quantized.data.buffer),C),C+=s,e.color instanceof E&&(S.set(new Uint8Array(e.color.minmaxMatrix.data.buffer),C),C+=o),S.set(new Uint8Array(e.color.quantized.data.buffer),C),C+=l,e.opacity instanceof E&&(S.set(new Uint8Array(e.opacity.minmaxMatrix.data.buffer),C),C+=o),S.set(new Uint8Array(e.opacity.quantized.data.buffer),C),C+=d,e.scaling instanceof E&&(S.set(new Uint8Array(e.scaling.minmaxMatrix.data.buffer),C),C+=o),S.set(new Uint8Array(e.scaling.quantized.data.buffer),C),C+=p,e.quaternion instanceof E&&(S.set(new Uint8Array(e.quaternion.minmaxMatrix.data.buffer),C),C+=o),S.set(new Uint8Array(e.quaternion.quantized.data.buffer),C),C+=h,b>0&&e.harmonics&&e.harmonics.length>0)for(let t=0;t<e.harmonics.length;t++){let n=e.harmonics[t];n instanceof E&&(S.set(new Uint8Array(n.minmaxMatrix.data.buffer),C),C+=o),S.set(new Uint8Array(n.quantized.data.buffer),C),C+=n.quantized.data.byteLength}return new Bn(S.buffer)}};export{V as CompressedGaussianSplats,Bn as GSplineBuffer,B as GaussianPLYData};